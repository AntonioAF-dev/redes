<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SGILAB ‚Äî Laboratorio P5-206</title>
<link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=JetBrains+Mono:wght@300;400;500;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<style>
:root {
  --bg:#06090f;--bg2:#0b1120;--bg3:#101828;--bg4:#161f30;
  --panel:#0e1825;--border:#1c2d42;--border2:#243548;
  --cyan:#00d4ff;--blue:#3b82f6;--green:#22c55e;
  --amber:#f59e0b;--orange:#f97316;--red:#ef4444;--purple:#a78bfa;
  --text:#e2eaf5;--text2:#7c9ab5;--text3:#3d5570;
  --mono:'JetBrains Mono',monospace;--head:'Rajdhani',sans-serif;--body:'Inter',sans-serif;
  --r:8px;--r2:12px;--shadow:0 4px 24px rgba(0,0,0,.5);
  --glow-c:0 0 24px rgba(0,212,255,.18);
}
*{margin:0;padding:0;box-sizing:border-box;}
html{scroll-behavior:smooth;}
body{background:var(--bg);color:var(--text);font-family:var(--body);min-height:100vh;overflow-x:hidden;}
body::before{content:'';position:fixed;inset:0;background:radial-gradient(ellipse 60% 40% at 80% 10%,rgba(0,212,255,.04) 0%,transparent 60%),radial-gradient(ellipse 40% 60% at 10% 80%,rgba(59,130,246,.04) 0%,transparent 60%);pointer-events:none;z-index:0;}
body::after{content:'';position:fixed;inset:0;background-image:linear-gradient(rgba(0,212,255,.016) 1px,transparent 1px),linear-gradient(90deg,rgba(0,212,255,.016) 1px,transparent 1px);background-size:48px 48px;pointer-events:none;z-index:0;}
*{position:relative;z-index:1;}
::-webkit-scrollbar{width:5px;height:5px;}
::-webkit-scrollbar-track{background:var(--bg);}
::-webkit-scrollbar-thumb{background:var(--border2);border-radius:3px;}

/* ‚îÄ‚îÄ SEVERITY SCALE ‚îÄ‚îÄ */
.sev-crit{background:rgba(239,68,68,.15);border:1px solid rgba(239,68,68,.4);color:#fca5a5;}
.sev-alto{background:rgba(249,115,22,.15);border:1px solid rgba(249,115,22,.4);color:#fdba74;}
.sev-medio{background:rgba(245,158,11,.15);border:1px solid rgba(245,158,11,.4);color:#fcd34d;}
.sev-bajo{background:rgba(234,179,8,.12);border:1px solid rgba(234,179,8,.3);color:#fde68a;}
.sev-ok{background:rgba(34,197,94,.1);border:1px solid rgba(34,197,94,.25);color:#86efac;}
.sev-dot-crit{background:#ef4444;box-shadow:0 0 6px #ef4444;}
.sev-dot-alto{background:#f97316;box-shadow:0 0 6px #f97316;}
.sev-dot-medio{background:#f59e0b;box-shadow:0 0 5px #f59e0b;}
.sev-dot-bajo{background:#eab308;}
.sev-dot-ok{background:#22c55e;box-shadow:0 0 5px #22c55e;}

/* ‚îÄ‚îÄ IP HIGHLIGHT ‚îÄ‚îÄ */
.ip-wrap{font-family:var(--mono);font-size:12px;}
.ip-oct{color:var(--text2);}
.ip-last{color:var(--cyan);font-weight:700;background:rgba(0,212,255,.12);padding:1px 5px;border-radius:4px;border:1px solid rgba(0,212,255,.25);}

/* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
header{position:sticky;top:0;z-index:500;background:rgba(6,9,15,.93);backdrop-filter:blur(16px);border-bottom:1px solid var(--border);display:flex;align-items:center;gap:16px;padding:0 24px;height:60px;box-shadow:0 2px 20px rgba(0,0,0,.4);}
.logo{display:flex;align-items:center;gap:10px;text-decoration:none;cursor:pointer;}
.logo-icon{width:36px;height:36px;border-radius:8px;background:linear-gradient(135deg,rgba(0,212,255,.15),rgba(59,130,246,.15));border:1px solid rgba(0,212,255,.3);display:grid;place-items:center;box-shadow:var(--glow-c);}
.logo-text{font-family:var(--head);font-size:20px;font-weight:700;letter-spacing:3px;color:var(--text);}
.logo-text span{color:var(--cyan);}
.logo-sub{font-family:var(--mono);font-size:9px;color:var(--text3);letter-spacing:2px;display:block;margin-top:-2px;}
nav{display:flex;gap:2px;margin-left:auto;}
.nav-btn{background:transparent;border:none;cursor:pointer;padding:7px 13px;border-radius:var(--r);font-family:var(--head);font-size:13px;font-weight:600;color:var(--text2);letter-spacing:1px;transition:all .2s;display:flex;align-items:center;gap:6px;}
.nav-btn:hover{color:var(--cyan);background:rgba(0,212,255,.06);}
.nav-btn.active{color:var(--cyan);background:rgba(0,212,255,.1);border:1px solid rgba(0,212,255,.2);}
.nav-btn svg{width:14px;height:14px;}
.ham{display:none;background:transparent;border:none;cursor:pointer;color:var(--text2);padding:6px;}
.ham svg{width:22px;height:22px;}
.mobile-nav{display:none;position:fixed;inset:60px 0 0 0;z-index:400;background:rgba(6,9,15,.97);backdrop-filter:blur(20px);flex-direction:column;align-items:stretch;padding:16px;gap:4px;border-top:1px solid var(--border);}
.mobile-nav.open{display:flex;}
.mobile-nav .nav-btn{justify-content:flex-start;padding:12px 16px;font-size:15px;}

/* ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ */
main{max-width:1440px;margin:0 auto;padding:24px 20px;}
.view{display:none;}
.view.active{display:block;}
.page-hd{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:24px;flex-wrap:wrap;gap:12px;}
.page-title{font-family:var(--head);font-size:26px;font-weight:700;letter-spacing:2px;}
.page-title span{color:var(--cyan);}
.page-sub{font-family:var(--mono);font-size:11px;color:var(--text3);letter-spacing:1.5px;margin-top:3px;}

/* ‚îÄ‚îÄ STATS ‚îÄ‚îÄ */
.stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(155px,1fr));gap:14px;margin-bottom:24px;}
.stat{background:var(--panel);border:1px solid var(--border);border-radius:var(--r2);padding:18px;overflow:hidden;position:relative;transition:transform .2s,border-color .2s;}
.stat:hover{transform:translateY(-2px);}
.stat::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;border-radius:2px 2px 0 0;}
.stat.c-cyan::before{background:var(--cyan);}
.stat.c-green::before{background:var(--green);}
.stat.c-red::before{background:var(--red);}
.stat.c-amber::before{background:var(--amber);}
.stat.c-blue::before{background:var(--blue);}
.stat.c-orange::before{background:var(--orange);}
.stat-label{font-family:var(--mono);font-size:10px;letter-spacing:2px;color:var(--text3);text-transform:uppercase;}
.stat-val{font-family:var(--head);font-size:40px;font-weight:700;line-height:1;margin:6px 0 2px;color:var(--text);}
.stat-sub{font-size:11px;color:var(--text2);}
.stat-icon{position:absolute;right:14px;top:50%;transform:translateY(-50%);opacity:.07;font-size:46px;}

/* ‚îÄ‚îÄ TOOLBAR ‚îÄ‚îÄ */
.toolbar{display:flex;align-items:center;gap:10px;margin-bottom:16px;flex-wrap:wrap;}
.search-box{display:flex;align-items:center;gap:8px;background:var(--panel);border:1px solid var(--border);border-radius:var(--r);padding:0 14px;flex:1;min-width:220px;max-width:380px;transition:border-color .2s;}
.search-box:focus-within{border-color:rgba(0,212,255,.5);box-shadow:var(--glow-c);}
.search-box svg{width:14px;height:14px;color:var(--text3);flex-shrink:0;}
.search-box input{background:transparent;border:none;outline:none;font-family:var(--mono);font-size:12px;color:var(--text);padding:10px 0;width:100%;}
.search-box input::placeholder{color:var(--text3);}
.filter-sel{background:var(--panel);border:1px solid var(--border);border-radius:var(--r);padding:9px 12px;font-family:var(--mono);font-size:12px;color:var(--text2);outline:none;cursor:pointer;transition:border-color .2s;}
.filter-sel:focus{border-color:rgba(0,212,255,.4);}
.view-toggle{display:flex;background:var(--panel);border:1px solid var(--border);border-radius:var(--r);overflow:hidden;}
.vt-btn{background:transparent;border:none;cursor:pointer;padding:8px 12px;color:var(--text3);transition:all .2s;display:flex;align-items:center;}
.vt-btn:hover{color:var(--cyan);}
.vt-btn.active{background:rgba(0,212,255,.1);color:var(--cyan);}
.vt-btn svg{width:16px;height:16px;}

/* ‚îÄ‚îÄ BUTTONS ‚îÄ‚îÄ */
.btn{display:inline-flex;align-items:center;gap:7px;padding:9px 18px;border-radius:var(--r);font-family:var(--head);font-size:13px;font-weight:600;letter-spacing:.5px;cursor:pointer;border:1px solid transparent;transition:all .2s;white-space:nowrap;}
.btn svg{width:15px;height:15px;}
.btn-primary{background:var(--blue);color:#fff;border-color:var(--blue);box-shadow:0 0 16px rgba(59,130,246,.3);}
.btn-primary:hover{background:#2563eb;}
.btn-cyan{background:rgba(0,212,255,.1);color:var(--cyan);border-color:rgba(0,212,255,.3);}
.btn-cyan:hover{background:rgba(0,212,255,.18);border-color:var(--cyan);}
.btn-green{background:rgba(34,197,94,.1);color:var(--green);border-color:rgba(34,197,94,.3);}
.btn-green:hover{background:rgba(34,197,94,.18);}
.btn-orange{background:rgba(249,115,22,.1);color:var(--orange);border-color:rgba(249,115,22,.3);}
.btn-orange:hover{background:rgba(249,115,22,.18);}
.btn-ghost{background:transparent;color:var(--text2);border-color:var(--border);}
.btn-ghost:hover{color:var(--text);border-color:var(--border2);}
.btn-danger{background:rgba(239,68,68,.1);color:var(--red);border-color:rgba(239,68,68,.3);}
.btn-danger:hover{background:rgba(239,68,68,.2);}
.btn-sm{padding:6px 12px;font-size:12px;}
.btn-xs{padding:4px 9px;font-size:11px;gap:4px;}

/* ‚îÄ‚îÄ BADGES ‚îÄ‚îÄ */
.badge{display:inline-flex;align-items:center;gap:5px;padding:3px 9px;border-radius:20px;font-family:var(--mono);font-size:10px;font-weight:500;letter-spacing:.5px;}
.badge::before{content:'';width:5px;height:5px;border-radius:50%;flex-shrink:0;}
.b-green{background:rgba(34,197,94,.12);color:var(--green);border:1px solid rgba(34,197,94,.25);}
.b-green::before{background:var(--green);box-shadow:0 0 5px var(--green);}
.b-red{background:rgba(239,68,68,.12);color:var(--red);border:1px solid rgba(239,68,68,.25);}
.b-red::before{background:var(--red);}
.b-amber{background:rgba(245,158,11,.12);color:var(--amber);border:1px solid rgba(245,158,11,.25);}
.b-amber::before{background:var(--amber);}
.b-orange{background:rgba(249,115,22,.12);color:var(--orange);border:1px solid rgba(249,115,22,.25);}
.b-orange::before{background:var(--orange);}
.b-cyan{background:rgba(0,212,255,.12);color:var(--cyan);border:1px solid rgba(0,212,255,.25);}
.b-cyan::before{background:var(--cyan);}

/* ‚îÄ‚îÄ CARD GRID ‚îÄ‚îÄ */
.card-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:16px;}
.eq-card{background:var(--panel);border:1px solid var(--border);border-radius:var(--r2);overflow:hidden;cursor:pointer;transition:transform .2s,border-color .2s,box-shadow .2s;}
.eq-card:hover{transform:translateY(-3px);border-color:var(--border2);box-shadow:0 8px 32px rgba(0,0,0,.4);}
.eq-card.e-falla{border-left:3px solid var(--red);}
.eq-card.e-operativo{border-left:3px solid var(--green);}
.eq-card.e-mantenimiento{border-left:3px solid var(--amber);}
.card-head{padding:13px 15px 11px;display:flex;align-items:flex-start;justify-content:space-between;gap:8px;border-bottom:1px solid var(--border);background:rgba(255,255,255,.02);}
.card-code{font-family:var(--mono);font-size:11px;color:var(--cyan);letter-spacing:1px;font-weight:500;}
.card-loc{font-size:12px;color:var(--text2);margin-top:2px;}
.card-body{padding:13px 15px;}
.card-spec{display:flex;align-items:center;gap:6px;margin-bottom:6px;font-size:12px;color:var(--text2);}
.card-spec svg{width:12px;height:12px;color:var(--text3);flex-shrink:0;}
.card-spec strong{color:var(--text);font-weight:500;}
.falla-chip{margin-top:8px;padding:5px 8px;border-radius:6px;font-size:10px;font-family:var(--mono);overflow:hidden;white-space:nowrap;text-overflow:ellipsis;cursor:help;}
.card-foot{padding:9px 15px;border-top:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;background:rgba(0,0,0,.2);}
.card-actions{display:flex;gap:5px;}

/* ‚îÄ‚îÄ TABLE ‚îÄ‚îÄ */
.tbl-wrap{background:var(--panel);border:1px solid var(--border);border-radius:var(--r2);overflow:hidden;overflow-x:auto;}
table{width:100%;border-collapse:collapse;min-width:750px;}
thead{background:rgba(0,212,255,.04);border-bottom:1px solid var(--border2);}
th{padding:11px 14px;text-align:left;font-family:var(--mono);font-size:10px;font-weight:400;letter-spacing:1.5px;color:var(--text3);text-transform:uppercase;white-space:nowrap;}
td{padding:11px 14px;font-size:12px;color:var(--text2);border-bottom:1px solid rgba(28,45,66,.5);white-space:nowrap;}
tr:last-child td{border-bottom:none;}
tbody tr{transition:background .15s;}
tbody tr:hover{background:rgba(0,212,255,.03);}
.td-mono{font-family:var(--mono);font-size:11px;}
.td-bold{color:var(--text);font-weight:500;}

/* ‚îÄ‚îÄ CHESSBOARD MAP ‚îÄ‚îÄ */
.chess-outer{display:grid;grid-template-columns:1fr 310px;gap:20px;align-items:start;}
@media(max-width:1250px){.chess-outer{grid-template-columns:1fr;}}
@media(max-width:1250px){.cs-panel{display:grid!important;grid-template-columns:1fr 1fr;gap:14px;}}
@media(max-width:640px){.cs-panel{display:flex!important;flex-direction:column;}}
.chess-scroll{overflow-x:auto;overflow-y:visible;-webkit-overflow-scrolling:touch;padding-bottom:4px;}
.chess-scroll::-webkit-scrollbar{height:6px;}
.chess-scroll::-webkit-scrollbar-track{background:rgba(0,0,0,.2);border-radius:3px;}
.chess-scroll::-webkit-scrollbar-thumb{background:rgba(0,212,255,.3);border-radius:3px;}
.chess-room{
  min-width:900px;
  background:rgba(3,9,20,.97);
  border:2px solid rgba(59,130,246,.3);
  border-radius:12px;
  overflow:visible;
  box-shadow:0 0 60px rgba(0,212,255,.07),inset 0 0 120px rgba(0,0,0,.6);
}
/* top & bottom walls */
.chess-wall{display:flex;align-items:center;justify-content:space-between;padding:9px 16px;background:rgba(0,18,45,.85);gap:12px;flex-wrap:wrap;border-radius:10px 10px 0 0;}
.chess-wall-bot{border-radius:0 0 10px 10px;}
.chess-wall-top{border-bottom:2px solid rgba(59,130,246,.3);}
.chess-wall-bot{border-top:2px solid rgba(59,130,246,.3);}
.chess-wall-txt{font-family:var(--mono);font-size:10px;color:var(--text3);letter-spacing:1px;}
/* body ‚Äî grid unificado 12 cols: [roseta-L] [10 cols board] [roseta-R] */
.chess-body{display:grid;grid-template-columns:minmax(0,1fr) repeat(10,minmax(0,1fr)) minmax(0,1fr);}
.chess-left-wall{grid-column:1;background:rgba(0,12,30,.75);border-right:2px solid rgba(59,130,246,.25);display:flex;flex-direction:column;}
.chess-right-wall{grid-column:12;background:rgba(0,12,30,.75);border-left:2px solid rgba(59,130,246,.25);display:flex;flex-direction:column;}
.chess-board-wrap{grid-column:2/12;display:grid;grid-template-columns:repeat(10,minmax(0,1fr));grid-template-rows:repeat(6,1fr);}
.wall-cell{flex:1;display:flex;align-items:center;justify-content:center;padding:4px 3px;border-bottom:1px solid rgba(59,130,246,.1);}
.wall-cell:last-child{border-bottom:none;}
/* BOARD */
.chess-board{grid-column:2/12;display:grid;grid-template-columns:repeat(10,minmax(0,1fr));grid-template-rows:repeat(6,auto);}
.cb{min-height:88px;border:1px solid rgba(0,212,255,.06);position:relative;}
.cb-dark{background:rgba(2,12,28,.93);}
.cb-light{background:rgba(0,28,55,.55);}
/* PC piece */
.cb-pc{
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  cursor:pointer;border:1.5px solid transparent;gap:2px;padding:5px 3px;
  transition:transform .18s,box-shadow .18s;
}
.cb-pc:hover{transform:scale(1.22) translateY(-4px);z-index:50;box-shadow:0 10px 30px rgba(0,0,0,.8);}
/* FP (rosette) */
.fp-grp{display:flex;flex-direction:column;gap:2px;padding:4px 5px;border-radius:6px;border:1px solid;background:rgba(2,10,25,.95);width:100%;box-sizing:border-box;}
.fp-pins{display:flex;gap:3px;margin-bottom:3px;}
.fp-pin{width:7px;height:15px;border-radius:2px;}
.fp-ip-row{display:flex;align-items:center;gap:4px;cursor:pointer;padding:2px 3px;border-radius:3px;transition:background .15s;}
.fp-ip-row:hover{background:rgba(0,212,255,.08);}
.fp-ip-row:hover .fp-pc-lbl{color:var(--cyan)!important;}
.fp-pin-sm{width:5px;height:12px;border-radius:1.5px;flex-shrink:0;}
.fp-pc-lbl{font-family:var(--mono);font-size:9px;font-weight:800;transition:color .15s;flex:1;line-height:1;}
.fp-pc-ip{font-family:var(--mono);font-size:8.5px;color:#ff6b6b;font-weight:900;}
.fp-status-dot{width:6px;height:6px;border-radius:50%;flex-shrink:0;}
.fp-entry{display:flex;flex-direction:column;gap:0px;cursor:pointer;padding:3px 3px;border-radius:3px;transition:background .15s;border-bottom:1px solid rgba(28,45,66,.25);}
.fp-entry:last-child{border-bottom:none;}
.fp-entry:hover{background:rgba(0,212,255,.07);}
/* Chess piece text */
.cp-code{font-family:var(--mono);font-size:10.5px;font-weight:900;letter-spacing:.5px;line-height:1;}
.cp-icon{font-size:18px;margin:2px 0;line-height:1;}
.cp-ip{font-family:var(--mono);font-size:9px;color:#ff6b6b;font-weight:900;}
.cp-dot{width:8px;height:8px;border-radius:50%;margin-top:2px;}
/* Door */
.cb-door{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:3px;height:100%;padding:6px;}
/* Tooltip */
.fp-tip{position:fixed;z-index:9999;pointer-events:none;opacity:0;transition:opacity .12s;
  background:var(--bg2);border:1px solid var(--border2);border-radius:12px;
  padding:14px 16px;min-width:260px;max-width:320px;
  box-shadow:0 12px 50px rgba(0,0,0,.85),0 0 30px rgba(0,212,255,.12);}
.fp-tip.on{opacity:1;}
.fp-tip-code{font-family:var(--mono);font-size:12px;color:var(--cyan);font-weight:900;margin-bottom:8px;border-bottom:1px solid rgba(0,212,255,.2);padding-bottom:6px;}
.fp-tip-row{display:flex;justify-content:space-between;gap:12px;padding:3.5px 0;font-size:11px;border-bottom:1px solid rgba(28,45,66,.3);}
.fp-tip-row:last-child{border-bottom:none;}
.fp-tip-l{color:var(--text3);}
.fp-tip-v{color:var(--text);font-weight:600;text-align:right;max-width:175px;overflow:hidden;text-overflow:ellipsis;}
.fp-tip-v.mono{font-family:var(--mono);font-size:10px;}
/* Sidebar */
.cs-panel{display:flex;flex-direction:column;gap:14px;}
.cs-card{background:var(--panel);border:1px solid var(--border);border-radius:var(--r2);padding:16px;}
.cs-title{font-family:var(--head);font-size:14px;font-weight:700;letter-spacing:1.5px;color:var(--text);margin-bottom:13px;display:flex;align-items:center;gap:8px;padding-bottom:8px;border-bottom:1px solid var(--border);}
.cs-row{display:flex;justify-content:space-between;align-items:center;padding:5px 0;border-bottom:1px solid rgba(28,45,66,.4);}
.cs-row:last-child{border-bottom:none;}
.cs-lbl{font-size:11.5px;color:var(--text2);}
.cs-val{font-family:var(--mono);font-size:12px;font-weight:700;}
/* Rosette items */
.ri-item{margin-bottom:10px;padding:8px 10px;border-radius:7px;border-left:3px solid;}
.ri-title{font-family:var(--mono);font-size:10px;font-weight:800;margin-bottom:5px;letter-spacing:.5px;}
.ri-pcs{display:flex;flex-direction:column;gap:2px;}
.ri-pc{display:flex;align-items:center;gap:6px;padding:3px 4px;border-bottom:1px solid rgba(28,45,66,.2);cursor:pointer;border-radius:4px;transition:background .15s;}
.ri-pc:hover{background:rgba(0,212,255,.06);}
.ri-pc:last-child{border-bottom:none;}
/* Col headers */
.chess-col-labels{display:grid;grid-template-columns:minmax(0,1fr) repeat(10,minmax(0,1fr)) minmax(0,1fr);gap:0;margin-top:6px;min-width:900px;}
.chess-col-labels>div{text-align:center;font-family:var(--mono);font-size:8px;color:var(--text3);letter-spacing:.5px;padding-bottom:3px;}
.chess-left-spacer{}
.chess-right-spacer{}
/* Fila labels on left of board */
.chess-fila-bar{display:flex;flex-direction:column;}
.chess-fila-bar .fila-lbl{flex:1;display:flex;align-items:center;justify-content:center;font-family:var(--mono);font-size:9px;color:rgba(0,212,255,.4);font-weight:700;border-bottom:1px solid rgba(59,130,246,.1);}
.chess-fila-bar .fila-lbl:last-child{border-bottom:none;}
/* legacy */
.lab-map{background:var(--bg3);border:1px solid var(--border);border-radius:var(--r2);padding:20px;}
.map-title{font-family:var(--head);font-size:14px;font-weight:700;letter-spacing:1px;color:var(--text);margin-bottom:16px;}
.lab-grid{display:grid;gap:8px;}
.lab-row{display:flex;align-items:center;gap:8px;}
.row-label{font-family:var(--mono);font-size:10px;color:var(--text3);min-width:52px;letter-spacing:1px;}
.pc-node{width:44px;height:36px;border-radius:6px;border:1px solid;display:flex;align-items:center;justify-content:center;font-family:var(--mono);font-size:9px;font-weight:700;cursor:pointer;transition:transform .15s,box-shadow .15s;flex-shrink:0;}
.pc-node:hover{transform:scale(1.1);z-index:10;}
.pc-op{background:rgba(34,197,94,.12);border-color:rgba(34,197,94,.4);color:var(--green);}
.pc-falla{background:rgba(239,68,68,.15);border-color:rgba(239,68,68,.5);color:var(--red);}
.pc-mant{background:rgba(245,158,11,.12);border-color:rgba(245,158,11,.4);color:var(--amber);}
.map-legend{display:flex;gap:16px;margin-top:14px;flex-wrap:wrap;}
.map-leg-item{display:flex;align-items:center;gap:6px;font-size:11px;color:var(--text2);}
.map-leg-dot{width:10px;height:10px;border-radius:3px;border:1px solid;}

/* ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ */
.overlay{display:none;position:fixed;inset:0;z-index:600;background:rgba(0,0,0,.8);backdrop-filter:blur(6px);overflow-y:auto;padding:20px;}
.overlay.open{display:flex;align-items:flex-start;justify-content:center;}
.modal{background:var(--bg2);border:1px solid var(--border2);border-radius:16px;width:100%;max-width:900px;box-shadow:0 40px 80px rgba(0,0,0,.6),var(--glow-c);animation:modalIn .3s cubic-bezier(.34,1.56,.64,1);overflow:hidden;}
.modal-lg{max-width:1060px;}
@keyframes modalIn{from{opacity:0;transform:translateY(-16px) scale(.97);}to{opacity:1;transform:translateY(0) scale(1);}}
.modal-hd{display:flex;align-items:center;justify-content:space-between;padding:18px 24px;border-bottom:1px solid var(--border);background:rgba(255,255,255,.02);}
.modal-title{font-family:var(--head);font-size:16px;font-weight:700;letter-spacing:1.5px;}
.modal-close{background:transparent;border:none;cursor:pointer;color:var(--text3);font-size:22px;line-height:1;padding:4px;border-radius:6px;transition:color .2s,background .2s;}
.modal-close:hover{color:var(--red);background:rgba(239,68,68,.1);}
.modal-body{padding:24px;}
.modal-ft{display:flex;justify-content:flex-end;gap:10px;padding:14px 24px;border-top:1px solid var(--border);background:rgba(0,0,0,.2);}

/* ‚îÄ‚îÄ DETAIL ‚îÄ‚îÄ */
.detail-layout{display:grid;grid-template-columns:1fr 200px;gap:20px;}
.detail-sections{display:flex;flex-direction:column;gap:14px;}
.detail-sec{background:var(--bg3);border:1px solid var(--border);border-radius:var(--r2);padding:16px;}
.detail-sec-title{font-family:var(--mono);font-size:10px;letter-spacing:2px;color:var(--cyan);text-transform:uppercase;margin-bottom:12px;padding-bottom:8px;border-bottom:1px solid rgba(0,212,255,.15);display:flex;align-items:center;gap:8px;}
.detail-sec-title::before{content:'';width:2px;height:12px;background:var(--cyan);border-radius:2px;}
.detail-row{display:flex;align-items:flex-start;gap:8px;padding:5px 0;border-bottom:1px solid rgba(28,45,66,.4);}
.detail-row:last-child{border-bottom:none;}
.detail-lbl{font-size:11px;color:var(--text3);min-width:118px;flex-shrink:0;padding-top:1px;}
.detail-val{font-size:12px;color:var(--text);font-weight:500;flex:1;word-break:break-all;}
.detail-grid2{display:grid;grid-template-columns:1fr 1fr;gap:2px;}
.detail-sidebar{display:flex;flex-direction:column;gap:12px;}
.qr-box{background:var(--bg3);border:1px solid var(--border);border-radius:var(--r2);padding:14px;text-align:center;}
.qr-label{font-family:var(--mono);font-size:9px;color:var(--text3);letter-spacing:2px;text-transform:uppercase;margin-bottom:10px;}
#qr-canvas{display:flex;justify-content:center;align-items:center;min-height:160px;}
#qr-canvas canvas,#qr-canvas img{border-radius:6px;max-width:100%;height:auto;}

/* ‚îÄ‚îÄ FORM ‚îÄ‚îÄ */
.form-sec{margin-bottom:20px;}
.form-sec-title{font-family:var(--mono);font-size:10px;letter-spacing:2px;color:var(--cyan);text-transform:uppercase;margin-bottom:12px;padding-bottom:8px;border-bottom:1px solid rgba(0,212,255,.15);display:flex;align-items:center;gap:8px;}
.form-sec-title::before{content:'';width:2px;height:12px;background:var(--cyan);border-radius:2px;}
.fg{display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(170px,1fr));}
.fg.c2{grid-template-columns:1fr 1fr;}
.fg.c3{grid-template-columns:1fr 1fr 1fr;}
.fgrp{display:flex;flex-direction:column;gap:5px;}
.fgrp.full{grid-column:1/-1;}
label{font-size:11px;font-weight:600;letter-spacing:1px;color:var(--text3);text-transform:uppercase;}
input,select,textarea{background:rgba(255,255,255,.04);border:1px solid var(--border);border-radius:var(--r);padding:9px 12px;color:var(--text);font-family:var(--mono);font-size:12px;outline:none;transition:border-color .2s,box-shadow .2s;width:100%;}
input:focus,select:focus,textarea:focus{border-color:rgba(0,212,255,.5);box-shadow:0 0 0 2px rgba(0,212,255,.08);}
select option{background:var(--bg2);}
.err{font-size:10px;color:var(--red);min-height:14px;}

/* ‚îÄ‚îÄ REPORTS ‚îÄ‚îÄ */
.report-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:14px;margin-bottom:20px;}
.rcard{background:var(--panel);border:1px solid var(--border);border-radius:var(--r2);padding:18px;}
.rcard-title{font-family:var(--head);font-size:13px;font-weight:700;letter-spacing:1px;color:var(--text);margin-bottom:14px;display:flex;align-items:center;gap:8px;}
.bar-item{display:flex;align-items:center;gap:10px;margin-bottom:8px;}
.bar-lbl{font-size:11px;color:var(--text2);min-width:90px;}
.bar-track{flex:1;height:6px;background:var(--bg3);border-radius:3px;overflow:hidden;}
.bar-fill{height:100%;border-radius:3px;transition:width .7s ease;}
.bar-cnt{font-family:var(--mono);font-size:11px;color:var(--text3);min-width:22px;text-align:right;}
.export-row{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:20px;}

/* ‚îÄ‚îÄ SEVERITY LEGEND ‚îÄ‚îÄ */
.sev-legend{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:16px;}
.sev-leg{display:flex;align-items:center;gap:6px;padding:5px 10px;border-radius:20px;font-family:var(--mono);font-size:10px;}

/* ‚îÄ‚îÄ PAGER ‚îÄ‚îÄ */
.pager{display:flex;align-items:center;justify-content:space-between;margin-top:16px;flex-wrap:wrap;gap:10px;}
.pager-info{font-family:var(--mono);font-size:11px;color:var(--text3);}
.pager-btns{display:flex;gap:4px;}
.pg-btn{background:var(--panel);border:1px solid var(--border);border-radius:6px;padding:5px 10px;font-family:var(--mono);font-size:11px;color:var(--text2);cursor:pointer;transition:all .2s;}
.pg-btn:hover{border-color:var(--cyan);color:var(--cyan);}
.pg-btn.active{background:rgba(0,212,255,.1);border-color:rgba(0,212,255,.4);color:var(--cyan);}
.pg-btn:disabled{opacity:.3;cursor:default;}

/* ‚îÄ‚îÄ AUTHORS ‚îÄ‚îÄ */
.authors-wrap{background:var(--panel);border:1px solid var(--border);border-radius:var(--r2);padding:28px;}
.authors-hd-title{font-family:var(--head);font-size:22px;font-weight:700;letter-spacing:2px;margin-bottom:4px;}
.authors-hd-sub{font-family:var(--mono);font-size:11px;color:var(--text3);letter-spacing:1.5px;margin-bottom:24px;}
.authors-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:14px;}
.acard{background:var(--bg3);border:1px solid var(--border);border-radius:var(--r2);padding:18px;display:flex;gap:14px;align-items:flex-start;transition:border-color .2s,transform .2s;}
.acard:hover{border-color:rgba(0,212,255,.3);transform:translateY(-2px);}
.acard-av{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,rgba(0,212,255,.2),rgba(59,130,246,.2));border:2px solid rgba(0,212,255,.2);display:flex;align-items:center;justify-content:center;font-family:var(--head);font-size:20px;font-weight:700;color:var(--cyan);flex-shrink:0;}
.acard-name{font-family:var(--head);font-size:14px;font-weight:700;color:var(--text);letter-spacing:.5px;}
.acard-role{font-family:var(--mono);font-size:10px;color:var(--cyan);letter-spacing:1px;margin-top:3px;}
.acard-code{font-family:var(--mono);font-size:10px;color:var(--text3);margin-top:5px;background:rgba(255,255,255,.04);padding:3px 7px;border-radius:4px;border:1px solid var(--border);display:inline-block;}
.lab-info-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px;margin-top:18px;background:var(--bg3);border:1px solid var(--border);border-radius:var(--r2);padding:18px;}
.li-item{display:flex;flex-direction:column;gap:3px;}
.li-lbl{font-family:var(--mono);font-size:10px;color:var(--text3);letter-spacing:1.5px;text-transform:uppercase;}
.li-val{font-family:var(--head);font-size:14px;font-weight:600;color:var(--text);}

/* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
.toast-box{position:fixed;bottom:24px;right:24px;z-index:1000;display:flex;flex-direction:column;gap:8px;}
.toast{background:var(--bg2);border:1px solid var(--border2);border-radius:var(--r);padding:12px 18px;font-size:13px;color:var(--text);display:flex;align-items:center;gap:10px;min-width:260px;box-shadow:var(--shadow);animation:toastIn .3s ease;}
.toast.success{border-left:3px solid var(--green);}
.toast.error{border-left:3px solid var(--red);}
.toast.info{border-left:3px solid var(--cyan);}
@keyframes toastIn{from{opacity:0;transform:translateX(20px);}to{opacity:1;transform:translateX(0);}}

/* ‚îÄ‚îÄ EMPTY ‚îÄ‚îÄ */
.empty{text-align:center;padding:60px 20px;}
.empty-icon{font-size:48px;margin-bottom:12px;opacity:.4;}
.empty-text{color:var(--text3);font-size:14px;font-family:var(--mono);}

/* ‚îÄ‚îÄ PRINT/PDF STYLES ‚îÄ‚îÄ */
@media print {
  body{background:#fff!important;color:#000!important;}
  body::before,body::after{display:none!important;}
  header,nav,.ham,.mobile-nav,.toast-box,.overlay,
  .toolbar .btn,.card-actions,.modal-ft,
  button:not(.print-keep){display:none!important;}
  .view{display:block!important;}
  .page-title,.page-sub,.stat-label{color:#000!important;}
  .stat{background:#f8f8f8!important;border-color:#ccc!important;color:#000!important;}
  .stat-val{color:#000!important;}
  .tbl-wrap{border:1px solid #ccc!important;background:#fff!important;}
  th{background:#f0f0f0!important;color:#333!important;}
  td{color:#000!important;border-color:#ddd!important;}
  .badge{border:1px solid #999!important;color:#333!important;}
  .badge::before{display:none!important;}
  .falla-chip{background:#fff3f3!important;border-color:#ccc!important;color:#c00!important;}
  .ip-last{background:#e8f5ff!important;color:#005!important;}
  .eq-card{break-inside:avoid;page-break-inside:avoid;}
  .card-grid{grid-template-columns:1fr 1fr!important;}
  @page{margin:1.5cm;size:A4;}
  .print-section{page-break-before:always;}
}

/* ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ */
@media(max-width:1024px){.detail-grid2{grid-template-columns:1fr;}}
@media(max-width:900px){.detail-layout{grid-template-columns:1fr;}.detail-sidebar{order:-1;}.qr-box{display:flex;align-items:center;gap:14px;text-align:left;}.fg.c3{grid-template-columns:1fr 1fr;}}
@media(max-width:640px){header{padding:0 14px;height:54px;}nav{display:none;}.ham{display:flex;}main{padding:14px 12px;}.stats{grid-template-columns:1fr 1fr;}.card-grid{grid-template-columns:1fr;}.toolbar{flex-direction:column;align-items:stretch;}.search-box{max-width:none;}.fg,.fg.c2,.fg.c3{grid-template-columns:1fr;}.modal-body{padding:16px;}.modal-hd{padding:14px 16px;}.detail-grid2{grid-template-columns:1fr;}.authors-grid{grid-template-columns:1fr;}.page-hd{flex-direction:column;}.acard{flex-direction:column;gap:10px;}}
@media(max-width:400px){.stats{grid-template-columns:1fr;}.authors-grid{grid-template-columns:1fr;}.cs-panel{grid-template-columns:1fr!important;}}
</style>
</head>
<body>

<header>
  <div class="logo" onclick="showView('dashboard')">
    <div class="logo-icon">
      <svg viewBox="0 0 24 24" fill="none" stroke="#00d4ff" stroke-width="2" width="18" height="18"><rect x="2" y="3" width="20" height="14" rx="2"/><path d="M8 21h8M12 17v4"/></svg>
    </div>
    <div>
      <div class="logo-text">SGI<span>LAB</span></div>
      <div class="logo-sub">LABORATORIO P5 ‚Äî AULA 206</div>
    </div>
  </div>
  <nav>
    <button class="nav-btn active" id="nav-dashboard" onclick="showView('dashboard')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg>DASHBOARD
    </button>
    <button class="nav-btn" id="nav-equipos" onclick="showView('equipos')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2"/><path d="M8 21h8M12 17v4"/></svg>EQUIPOS
    </button>
    <button class="nav-btn" id="nav-mapa" onclick="showView('mapa')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6"/><line x1="8" y1="2" x2="8" y2="18"/><line x1="16" y1="6" x2="16" y2="22"/></svg>MAPA
    </button>
    <button class="nav-btn" id="nav-reportes" onclick="showView('reportes')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 3v18h18"/><polyline points="19 9 13 15 9 11 5 15"/></svg>REPORTES
    </button>
    <button class="nav-btn" id="nav-autores" onclick="showView('autores')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>AUTORES
    </button>
  </nav>
  <button class="ham" onclick="toggleMob()">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
  </button>
</header>

<div class="mobile-nav" id="mobile-nav">
  <button class="nav-btn" onclick="showView('dashboard');toggleMob()">üìä DASHBOARD</button>
  <button class="nav-btn" onclick="showView('equipos');toggleMob()">üñ•Ô∏è EQUIPOS</button>
  <button class="nav-btn" onclick="showView('mapa');toggleMob()">üó∫Ô∏è MAPA DE RED</button>
  <button class="nav-btn" onclick="showView('reportes');toggleMob()">üìà REPORTES</button>
  <button class="nav-btn" onclick="showView('autores');toggleMob()">üë• AUTORES</button>
</div>

<main>

<!-- ‚ïê‚ïê DASHBOARD ‚ïê‚ïê -->
<div class="view active" id="view-dashboard">
  <div class="page-hd">
    <div><div class="page-title">PANEL <span>PRINCIPAL</span></div><div class="page-sub">RESUMEN DEL INVENTARIO ‚Äî LABORATORIO P5-206 ¬∑ 32 EQUIPOS</div></div>
    <button class="btn btn-primary" onclick="showView('equipos');openModal()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" width="15" height="15"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>NUEVO EQUIPO
    </button>
  </div>
  <div class="stats" id="dash-stats"></div>
  <div id="dash-obs"></div>
</div>

<!-- ‚ïê‚ïê EQUIPOS ‚ïê‚ïê -->
<div class="view" id="view-equipos">
  <div class="page-hd">
    <div><div class="page-title">REGISTRO DE <span>EQUIPOS</span></div><div class="page-sub" id="eq-label">‚Äî</div></div>
    <div style="display:flex;gap:8px;flex-wrap:wrap;">
      <button class="btn btn-ghost btn-sm" onclick="exportCSV()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>CSV
      </button>
      <button class="btn btn-primary btn-sm" onclick="openModal()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" width="14" height="14"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>NUEVO
      </button>
    </div>
  </div>
  <div class="toolbar">
    <div class="search-box">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
      <input type="text" id="s-inp" placeholder="Buscar c√≥digo, IP, MAC, modelo..." oninput="renderEq()">
    </div>
    <select class="filter-sel" id="f-estado" onchange="renderEq()">
      <option value="all">Todos los estados</option>
      <option value="operativo">Operativo</option>
      <option value="falla">Con falla</option>
      <option value="mantenimiento">Mantenimiento</option>
    </select>
    <select class="filter-sel" id="f-fila" onchange="renderEq()">
      <option value="all">Todas las filas</option>
      <option value="FILA 1">Fila 1</option><option value="FILA 2">Fila 2</option>
      <option value="FILA 3">Fila 3</option><option value="FILA 4">Fila 4</option>
      <option value="FILA 5">Fila 5</option><option value="FILA 6">Fila 6</option>
      <option value="FILA 7">Fila 7</option><option value="FILA 8">Fila 8</option>
      <option value="FILA 9">Fila 9</option><option value="PRINCIPAL">Principal</option>
    </select>
    <select class="filter-sel" id="f-sev" onchange="renderEq()">
      <option value="all">Toda severidad</option>
      <option value="crit">üî¥ Cr√≠tico</option>
      <option value="alto">üü† Alto</option>
      <option value="medio">üü° Medio</option>
      <option value="bajo">üü¢ Bajo</option>
      <option value="ok">‚úÖ Sin fallas</option>
    </select>
    <div class="view-toggle">
      <button class="vt-btn active" id="vt-grid" onclick="setVM('grid')" title="Tarjetas">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg>
      </button>
      <button class="vt-btn" id="vt-tbl" onclick="setVM('table')" title="Tabla">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
      </button>
    </div>
  </div>
  <div id="eq-cont"></div>
  <div class="pager" id="pager"></div>
</div>

<!-- ‚ïê‚ïê MAPA ‚ïê‚ïê -->
<div class="view" id="view-mapa">
  <div class="page-hd">
    <div><div class="page-title">MAPA DE <span>RED</span></div><div class="page-sub">TOPOLOG√çA F√çSICA ‚Äî LABORATORIO P5-206</div></div>
  </div>
  <div id="mapa-cont"></div>
</div>

<!-- ‚ïê‚ïê REPORTES ‚ïê‚ïê -->
<div class="view" id="view-reportes">
  <div class="page-hd">
    <div><div class="page-title">PANEL DE <span>REPORTES</span></div><div class="page-sub">AN√ÅLISIS DEL ESTADO DEL LABORATORIO</div></div>
  </div>
  <div class="export-row">
    <button class="btn btn-orange btn-sm" onclick="exportPDF()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>EXPORTAR PDF
    </button>
    <button class="btn btn-green btn-sm" onclick="exportCSV()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>EXPORTAR CSV
    </button>
    <button class="btn btn-cyan btn-sm" onclick="exportJSON()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>EXPORTAR JSON
    </button>
    <button class="btn btn-ghost btn-sm" onclick="printReport()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14"><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect x="6" y="14" width="12" height="8"/></svg>IMPRIMIR
    </button>
  </div>
  <div class="sev-legend" id="sev-legend"></div>
  <div class="report-grid" id="report-cont"></div>
  <div id="fallas-wrap"></div>
</div>

<!-- ‚ïê‚ïê AUTORES ‚ïê‚ïê -->
<div class="view" id="view-autores">
  <div class="page-hd">
    <div><div class="page-title">EQUIPO DE <span>TRABAJO</span></div><div class="page-sub">REDES Y TELECOMUNICACIONES ‚Äî INGENIER√çA DE SISTEMAS</div></div>
  </div>
  <div class="authors-wrap">
    <div class="authors-hd-title">Autores del Proyecto</div>
    <div class="authors-hd-sub">INVENTARIO DE LABORATORIO P5-206 ¬∑ REDES Y TELECOMUNICACIONES ¬∑ 2026</div>
    <div class="authors-grid">
      <div class="acard">
        <div class="acard-av">AF</div>
        <div>
          <div class="acard-name">Acosta Falcon, Marco Antonio</div>
          <div class="acard-role">Estudiante de Ing. de Sistemas</div>
          <div class="acard-code">üìã 2023110559</div>
        </div>
      </div>
      <div class="acard">
        <div class="acard-av">AS</div>
        <div>
          <div class="acard-name">Aliaga Salas, H. Manuel</div>
          <div class="acard-role">Estudiante de Ing. de Sistemas</div>
          <div class="acard-code">üìã 2023110541</div>
        </div>
      </div>
      <div class="acard">
        <div class="acard-av">CG</div>
        <div>
          <div class="acard-name">Colqui Guillermo, Victor Daniel</div>
          <div class="acard-role">Estudiante de Ing. de Sistemas</div>
          <div class="acard-code">üìã 2023120009</div>
        </div>
      </div>
      <div class="acard">
        <div class="acard-av">EB</div>
        <div>
          <div class="acard-name">Espinoza Berrospi, Diego Omar</div>
          <div class="acard-role">Estudiante de Ing. de Sistemas</div>
          <div class="acard-code">üìã 2022110545</div>
        </div>
      </div>
    </div>
    <div class="lab-info-grid">
      <div class="li-item"><span class="li-lbl">Laboratorio</span><span class="li-val">Inform√°tica P5 ‚Äî Aula 206</span></div>
      <div class="li-item"><span class="li-lbl">Curso</span><span class="li-val">Redes y Telecomunicaciones</span></div>
      <div class="li-item"><span class="li-lbl">Total Equipos</span><span class="li-val" id="aut-total">32 equipos</span></div>
      <div class="li-item"><span class="li-lbl">Red LAN</span><span class="li-val">192.168.149.0/24</span></div>
      <div class="li-item"><span class="li-lbl">Gateway</span><span class="li-val">192.168.150.2</span></div>
      <div class="li-item"><span class="li-lbl">Cableado</span><span class="li-val">UTP CAT-6</span></div>
    </div>
  </div>
</div>

</main>

<footer style="text-align:center;padding:24px;border-top:1px solid var(--border);font-family:var(--mono);font-size:11px;color:var(--text3);letter-spacing:1px;margin-top:40px;">
  <span style="color:var(--cyan);">SGILAB</span> ‚Äî Sistema de Gesti√≥n de Inventario ¬∑ Laboratorio P5-206 ¬∑ Redes y Telecomunicaciones ¬∑ 2026
</footer>

<div class="toast-box" id="toast-box"></div>

<!-- DETAIL MODAL -->
<div class="overlay" id="ov-detail">
  <div class="modal modal-lg">
    <div class="modal-hd">
      <span class="modal-title" id="d-title">FICHA T√âCNICA</span>
      <div style="display:flex;gap:8px;align-items:center;">
        <button class="btn btn-cyan btn-sm" id="d-edit-btn">‚úè EDITAR</button>
        <button class="modal-close" onclick="closeDetail()">‚úï</button>
      </div>
    </div>
    <div class="modal-body" id="d-body"></div>
  </div>
</div>

<!-- FORM MODAL -->
<div class="overlay" id="ov-form">
  <div class="modal">
    <div class="modal-hd">
      <span class="modal-title" id="f-title">REGISTRAR EQUIPO</span>
      <button class="modal-close" onclick="closeModal()">‚úï</button>
    </div>
    <div class="modal-body">
      <form id="eq-form" onsubmit="return false;">
        <div class="form-sec">
          <div class="form-sec-title">DATOS GENERALES</div>
          <div class="fg c3">
            <div class="fgrp"><label>C√≥digo *</label><input id="fc-cod" placeholder="LAB-P5-206 / 001"><div class="err" id="fe-cod"></div></div>
            <div class="fgrp"><label>Ubicaci√≥n *</label><input id="fc-ub" placeholder="FILA 1 - PC01"><div class="err" id="fe-ub"></div></div>
            <div class="fgrp"><label>Usuario</label><input id="fc-usr" placeholder="Alumno / Docente"></div>
            <div class="fgrp"><label>Estado</label><select id="fc-est"><option value="operativo">Operativo</option><option value="falla">Con Falla</option><option value="mantenimiento">Mantenimiento</option></select></div>
          </div>
        </div>
        <div class="form-sec">
          <div class="form-sec-title">PROCESADOR, MEMORIA & GR√ÅFICA</div>
          <div class="fg c3">
            <div class="fgrp"><label>Marca CPU</label><input id="fc-cm" placeholder="Intel / AMD"></div>
            <div class="fgrp full" style="grid-column:span 2"><label>Modelo CPU</label><input id="fc-cmod" placeholder="INTEL CORE I7 - 4770"></div>
            <div class="fgrp"><label>Velocidad</label><input id="fc-cghz" placeholder="3.40 GHz"></div>
            <div class="fgrp"><label>RAM</label><input id="fc-ram" placeholder="8 GB"></div>
            <div class="fgrp"><label>Tipo RAM</label><select id="fc-ramt"><option>DDR3</option><option>DDR4</option><option>DDR5</option></select></div>
            <div class="fgrp"><label>Gr√°fica (VRAM)</label><input id="fc-gpu" placeholder="2 GB"></div>
          </div>
        </div>
        <div class="form-sec">
          <div class="form-sec-title">ALMACENAMIENTO & PERIF√âRICOS</div>
          <div class="fg c3">
            <div class="fgrp"><label>Tipo Almac.</label><select id="fc-ht"><option>SSD</option><option>HDD</option><option>NVMe SSD</option><option>-</option></select></div>
            <div class="fgrp"><label>Capacidad</label><input id="fc-hc" placeholder="240GB"></div>
            <div class="fgrp"><label>Monitor Marca</label><input id="fc-mm" placeholder="Samsung"></div>
            <div class="fgrp"><label>Monitor Tama√±o</label><input id="fc-mt" placeholder='19"'></div>
            <div class="fgrp"><label>Monitor Obs.</label><input id="fc-mo" placeholder="Con rayas / Ok"></div>
            <div class="fgrp"><label>Teclado Marca</label><input id="fc-tkm" placeholder="Microsoft"></div>
            <div class="fgrp"><label>Estado Teclado</label><select id="fc-tke"><option value="bueno">Bueno</option><option value="regular">Regular</option><option value="falla">Con Falla</option></select></div>
            <div class="fgrp"><label>Mouse Marca</label><input id="fc-mum" placeholder="Microsoft"></div>
            <div class="fgrp"><label>Estado Mouse</label><select id="fc-mue"><option value="bueno">Bueno</option><option value="regular">Regular</option><option value="falla">Con Falla</option></select></div>
          </div>
        </div>
        <div class="form-sec">
          <div class="form-sec-title">RED Y CABLEADO</div>
          <div class="fg c3">
            <div class="fgrp"><label>IP *</label><input id="fc-ip" placeholder="192.168.149.41"><div class="err" id="fe-ip"></div></div>
            <div class="fgrp"><label>Gateway</label><input id="fc-gw" placeholder="192.168.150.2"></div>
            <div class="fgrp"><label>MAC</label><input id="fc-mac" placeholder="00:22:4D:B0:E9:12"></div>
            <div class="fgrp"><label>Puerto Switch</label><input id="fc-sw" placeholder="-"></div>
            <div class="fgrp"><label>Puerto Patch</label><input id="fc-pp" placeholder="-"></div>
            <div class="fgrp"><label>Rack/Gabinete</label><input id="fc-rk" placeholder="-"></div>
            <div class="fgrp"><label>Tipo Cable</label><input id="fc-cab" placeholder="CAT-6"></div>
          </div>
        </div>
        <div class="form-sec">
          <div class="form-sec-title">MANTENIMIENTO</div>
          <div class="fg c3">
            <div class="fgrp"><label>Fecha √öltimo Mant.</label><input id="fc-mf" type="date"></div>
            <div class="fgrp"><label>Tipo Mant.</label><select id="fc-mt2"><option value="-">-</option><option value="preventivo">Preventivo</option><option value="correctivo">Correctivo</option></select></div>
            <div class="fgrp full"><label>Fallas Detectadas</label><textarea id="fc-fa" rows="2"></textarea></div>
            <div class="fgrp full"><label>Soluci√≥n Aplicada</label><textarea id="fc-sol" rows="2"></textarea></div>
          </div>
        </div>
      </form>
    </div>
    <div class="modal-ft">
      <button class="btn btn-ghost" onclick="closeModal()">CANCELAR</button>
      <button class="btn btn-primary" onclick="saveEq()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14"><polyline points="20 6 9 17 4 12"/></svg>GUARDAR
      </button>
    </div>
  </div>
</div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DATA & HELPERS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const STORE = 'sgilab_v4_2025';
let equipos = [], editId = null, curPage = 1, vm = 'grid';
const PER = 12;

const DATA = [{"id":"pc001","codigo":"LAB-P5-206 / 001","ubicacion":"FILA 1 - PC01","usuario":"Alumno","estado":"operativo","cpu_marca":"Intel","cpu_modelo":"INTEL CORE I7 - 4770","cpu_ghz":"3.40 GHz","ram_cap":"8 GB","ram_tipo":"DDR3","grafica":"2 GB","hdd_tipo":"SSD","hdd_cap":"240GB","monitor_marca":"Samsung","monitor_tam":"19\"","monitor_obs":"","teclado_marca":"Microsoft","teclado_estado":"bueno","mouse_marca":"Microsoft","mouse_estado":"regular","ip":"192.168.149.41","gateway":"192.168.150.2","mac":"00:22:4D:B0:E9:12","puerto_sw":"-","puerto_pp":"66B/D","rack":"-","cable_tipo":"CAT-6","mant_fecha":"-","mant_tipo":"-","fallas":"FALLA DE MOUSE SCROLL, PC FALTA DE MANTENIMIENTO","solucion":""},{"id":"pc002","codigo":"LAB-P5-206 / 002","ubicacion":"FILA 1 - PC02","usuario":"Alumno","estado":"operativo","cpu_marca":"Intel","cpu_modelo":"INTEL CORE I7 - 4770","cpu_ghz":"3.40 GHz","ram_cap":"8 GB","ram_tipo":"DDR3","grafica":"2 GB","hdd_tipo":"SSD","hdd_cap":"240GB","monitor_marca":"Samsung","monitor_tam":"19\"","monitor_obs":"","teclado_marca":"Microsoft","teclado_estado":"bueno","mouse_marca":"Microsoft","mouse_estado":"falla","ip":"192.168.149.42","gateway":"192.168.150.2","mac":"00:22:4D:B0:EB:7E","puerto_sw":"-","puerto_pp":"-","rack":"-","cable_tipo":"CAT-6","mant_fecha":"-","mant_tipo":"-","fallas":"FALLA DE MOUSE SCROLL, PC FALTA DE MANTENIMIENTO","solucion":""},{"id":"pc003","codigo":"LAB-P5-206 / 003","ubicacion":"FILA 1 - PC03","usuario":"Alumno","estado":"operativo","cpu_marca":"Intel","cpu_modelo":"INTEL CORE I7 - 4770","cpu_ghz":"3.40 GHz","ram_cap":"8 GB","ram_tipo":"DDR3","grafica":"2 GB","hdd_tipo":"SSD","hdd_cap":"240GB","monitor_marca":"Samsung","monitor_tam":"19\"","monitor_obs":"Con rayas","teclado_marca":"Microsoft","teclado_estado":"bueno","mouse_marca":"Microsoft","mouse_estado":"falla","ip":"192.168.149.43","gateway":"192.168.150.2","mac":"00:22:4D:B0:EA:E9","puerto_sw":"-","puerto_pp":"-","rack":"-","cable_tipo":"CAT-6","mant_fecha":"-","mant_tipo":"-","fallas":"FALLA DE MOUSE SCROLL, PC FALTA DE MANTENIMIENTO, PANTALLA CON RAYAS","solucion":""},{"id":"pc004","codigo":"LAB-P5-206 / 004","ubicacion":"FILA 1 - PC04","usuario":"Alumno","estado":"operativo","cpu_marca":"Intel","cpu_modelo":"INTEL CORE I7 - 4770","cpu_ghz":"3.40 GHz","ram_cap":"8 GB","ram_tipo":"DDR3","grafica":"2 GB","hdd_tipo":"SSD","hdd_cap":"240GB","monitor_marca":"Samsung","monitor_tam":"19\"","monitor_obs":"","teclado_marca":"Microsoft","teclado_estado":"bueno","mouse_marca":"Microsoft","mouse_estado":"falla","ip":"192.168.149.44","gateway":"192.168.150.2","mac":"00:22:4D:B0:E5:63","puerto_sw":"-","puerto_pp":"-","rack":"-","cable_tipo":"CAT-6","mant_fecha":"-","mant_tipo":"-","fallas":"FALLA DE MOUSE SCROLL, PC FALTA DE MANTENIMIENTO","solucion":""},{"id":"pc005","codigo":"LAB-P5-206 / 005","ubicacion":"FILA 2 - PC05","usuario":"Alumno","estado":"operativo","cpu_marca":"Intel","cpu_modelo":"INTEL CORE I7 - 4770","cpu_ghz":"3.40 GHz","ram_cap":"8 GB","ram_tipo":"DDR3","grafica":"2 GB","hdd_tipo":"SSD","hdd_cap":"240GB","monitor_marca":"Samsung","monitor_tam":"19\"","monitor_obs":"","teclado_marca":"Microsoft","teclado_estado":"bueno","mouse_marca":"Microsoft","mouse_estado":"falla","ip":"192.168.149.45","gateway":"192.168.150.2","mac":"38:D5:47:AC:7D:AD","puerto_sw":"-","puerto_pp":"64B/D","rack":"-","cable_tipo":"CAT-6","mant_fecha":"-","mant_tipo":"-","fallas":"FALLA DE MOUSE SCROLL, PC FALTA DE MANTENIMIENTO","solucion":""},{"id":"pc006","codigo":"LAB-P5-206 / 006","ubicacion":"FILA 2 - PC06","usuario":"Alumno","estado":"operativo","cpu_marca":"Intel","cpu_modelo":"INTEL CORE I7 - 4770","cpu_ghz":"3.40 GHz","ram_cap":"8 GB","ram_tipo":"DDR3","grafica":"2 GB","hdd_tipo":"SSD","hdd_cap":"240GB","monitor_marca":"Samsung","monitor_tam":"19\"","monitor_obs":"","teclado_marca":"Microsoft","teclado_estado":"bueno","mouse_marca":"Microsoft","mouse_estado":"regular","ip":"192.168.149.46","gateway":"192.168.150.2","mac":"00:22:4D:B0:E9:8A","puerto_sw":"-","puerto_pp":"65B/D","rack":"-","cable_tipo":"CAT-6","mant_fecha":"-","mant_tipo":"-","fallas":"FALLA DE MOUSE SCROLL, PC FALTA DE MANTENIMIENTO","solucion":""},{"id":"pc007","codigo":"LAB-P5-206 / 007","ubicacion":"FILA 2 - PC07","usuario":"Alumno","estado":"operativo","cpu_marca":"Intel","cpu_modelo":"INTEL CORE I7 - 4770","cpu_ghz":"3.40 GHz","ram_cap":"8 GB","ram_tipo":"DDR3","grafica":"2 GB","hdd_tipo":"SSD","hdd_cap":"240GB","monitor_marca":"Samsung","monitor_tam":"19\"","monitor_obs":"","teclado_marca":"Microsoft","teclado_estado":"bueno","mouse_marca":"Microsoft","mouse_estado":"regular","ip":"192.168.149.47","gateway":"192.168.150.2","mac":"00:22:4D:B0:E5:A4","puerto_sw":"-","puerto_pp":"63B/D","rack":"-","cable_tipo":"CAT-6","mant_fecha":"-","mant_tipo":"-","fallas":"FALLA DE MOUSE SCROLL, PC FALTA DE MANTENIMIENTO","solucion":""},{"id":"pc008","codigo":"LAB-P5-206 / 008","ubicacion":"FILA 3 - PC08","usuario":"Alumno","estado":"operativo","cpu_marca":"Intel","cpu_modelo":"INTEL CORE I7 - 4770","cpu_ghz":"3.40 GHz","ram_cap":"8 GB","ram_tipo":"DDR3","grafica":"2 GB","hdd_tipo":"SSD","hdd_cap":"240GB","monitor_marca":"Samsung","monitor_tam":"19\"","monitor_obs":"","teclado_marca":"Microsoft","teclado_estado":"bueno","mouse_marca":"Microsoft","mouse_estado":"regular","ip":"192.168.149.48","gateway":"192.168.150.2","mac":"00:22:4D:B0:EC:30","puerto_sw":"-","puerto_pp":"59B/D","rack":"-","cable_tipo":"CAT-6","mant_fecha":"-","mant_tipo":"-","fallas":"FALLA DE MOUSE SCROLL, PC FALTA DE MANTENIMIENTO","solucion":""},{"id":"pc009","codigo":"LAB-P5-206 / 009","ubicacion":"FILA 3 - PC09","usuario":"Alumno","estado":"operativo","cpu_marca":"Intel","cpu_modelo":"INTEL CORE I7 - 4770","cpu_ghz":"3.40 GHz","ram_cap":"8 GB","ram_tipo":"DDR3","grafica":"2 GB","hdd_tipo":"SSD","hdd_cap":"240GB","monitor_marca":"Samsung","monitor_tam":"19\"","monitor_obs":"","teclado_marca":"Microsoft","teclado_estado":"bueno","mouse_marca":"Microsoft","mouse_estado":"regular","ip":"192.168.149.49","gateway":"192.168.150.2","mac":"00:22:4D:B0:EF:74","puerto_sw":"-","puerto_pp":"60B/D","rack":"-","cable_tipo":"CAT-6","mant_fecha":"-","mant_tipo":"-","fallas":"FALLA DE MOUSE SCROLL, PC FALTA DE MANTENIMIENTO","solucion":""},{"id":"pc010","codigo":"LAB-P5-206 / 010","ubicacion":"FILA 3 - PC10","usuario":"Alumno","estado":"operativo","cpu_marca":"Intel","cpu_modelo":"INTEL CORE I7 - 4770","cpu_ghz":"3.40 GHz","ram_cap":"8 GB","ram_tipo":"DDR3","grafica":"2 GB","hdd_tipo":"SSD","hdd_cap":"240GB","monitor_marca":"Samsung","monitor_tam":"19\"","monitor_obs":"","teclado_marca":"Logitech","teclado_estado":"bueno","mouse_marca":"Microsoft","mouse_estado":"regular","ip":"192.168.149.50","gateway":"192.168.150.2","mac":"00:22:4D:B0:EF:F2","puerto_sw":"-","puerto_pp":"61B/D","rack":"-","cable_tipo":"CAT-6","mant_fecha":"-","mant_tipo":"-","fallas":"FALLA DE MOUSE SCROLL, PC FALTA DE MANTENIMIENTO","solucion":""},{"id":"pc011","codigo":"LAB-P5-206 / 011","ubicacion":"FILA 3 - PC11","usuario":"Alumno","estado":"operativo","cpu_marca":"Intel","cpu_modelo":"INTEL CORE I7 - 4770","cpu_ghz":"3.40 GHz","ram_cap":"8 GB","ram_tipo":"DDR3","grafica":"2 GB","hdd_tipo":"SSD","hdd_cap":"240GB","monitor_marca":"Samsung","monitor_tam":"19\"","monitor_obs":"","teclado_marca":"Logitech","teclado_estado":"bueno","mouse_marca":"Microsoft","mouse_estado":"regular","ip":"192.168.149.51","gateway":"192.168.150.2","mac":"00:22:4D:B0:E6:ED","puerto_sw":"-","puerto_pp":"62B/D","rack":"-","cable_tipo":"CAT-6","mant_fecha":"-","mant_tipo":"-","fallas":"FALLA DE MOUSE SCROLL, PC FALTA DE MANTENIMIENTO","solucion":""},{"id":"pc012","codigo":"LAB-P5-206 / 012","ubicacion":"FILA 4 - PC12","usuario":"Alumno","estado":"operativo","cpu_marca":"Intel","cpu_modelo":"INTEL CORE I7 - 4770","cpu_ghz":"3.40 GHz","ram_cap":"8 GB","ram_tipo":"DDR3","grafica":"2 GB","hdd_tipo":"SSD","hdd_cap":"240GB","monitor_marca":"Samsung","monitor_tam":"19\"","monitor_obs":"","teclado_marca":"Microsoft","teclado_estado":"bueno","mouse_marca":"Microsoft","mouse_estado":"falla","ip":"192.168.149.52","gateway":"192.168.150.2","mac":"FC:AA:14:A1:F9:7B","puerto_sw":"-","puerto_pp":"58B/D","rack":"-","cable_tipo":"CAT-6","mant_fecha":"-","mant_tipo":"-","fallas":"FALLA DE MOUSE SCROLL, PC FALTA DE MANTENIMIENTO","solucion":""},{"id":"pc013","codigo":"LAB-P5-206 / 013","ubicacion":"FILA 4 - PC13","usuario":"Alumno","estado":"operativo","cpu_marca":"Intel","cpu_modelo":"INTEL CORE I7 - 4770","cpu_ghz":"3.40 GHz","ram_cap":"8 GB","ram_tipo":"DDR3","grafica":"2 GB","hdd_tipo":"SSD","hdd_cap":"240GB","monitor_marca":"Samsung","monitor_tam":"19\"","monitor_obs":"","teclado_marca":"Microsoft","teclado_estado":"bueno","mouse_marca":"Microsoft","mouse_estado":"regular","ip":"192.168.149.53","gateway":"192.168.150.2","mac":"00:22:4D:B0:EF:39","puerto_sw":"-","puerto_pp":"-","rack":"-","cable_tipo":"CAT-6","mant_fecha":"-","mant_tipo":"-","fallas":"FALLA DE MOUSE SCROLL, PC FALTA DE MANTENIMIENTO","solucion":""},{"id":"pc014","codigo":"LAB-P5-206 / 014","ubicacion":"FILA 4 - PC14","usuario":"Alumno","estado":"operativo","cpu_marca":"Intel","cpu_modelo":"INTEL CORE I7 - 4770","cpu_ghz":"3.40 GHz","ram_cap":"8 GB","ram_tipo":"DDR3","grafica":"2 GB","hdd_tipo":"SSD","hdd_cap":"240GB","monitor_marca":"Samsung","monitor_tam":"19\"","monitor_obs":"Con rayas","teclado_marca":"Microsoft","teclado_estado":"bueno","mouse_marca":"Microsoft","mouse_estado":"regular","ip":"192.168.149.54","gateway":"192.168.150.2","mac":"00:22:4D:B0:E5:73","puerto_sw":"-","puerto_pp":"-","rack":"-","cable_tipo":"CAT-6","mant_fecha":"-","mant_tipo":"-","fallas":"FALLA DE MOUSE SCROLL, PC FALTA DE MANTENIMIENTO, PANTALLA CON RAYAS","solucion":""},{"id":"pc015","codigo":"LAB-P5-206 / 015","ubicacion":"FILA 4 - PC15","usuario":"Alumno","estado":"operativo","cpu_marca":"Intel","cpu_modelo":"INTEL CORE I7 - 4770","cpu_ghz":"3.40 GHz","ram_cap":"8 GB","ram_tipo":"DDR3","grafica":"2 GB","hdd_tipo":"SSD","hdd_cap":"240GB","monitor_marca":"Samsung","monitor_tam":"19\"","monitor_obs":"","teclado_marca":"Microsoft","teclado_estado":"bueno","mouse_marca":"Microsoft","mouse_estado":"regular","ip":"192.168.149.55","gateway":"192.168.150.2","mac":"00:22:4D:B0:E9:8E","puerto_sw":"-","puerto_pp":"-","rack":"-","cable_tipo":"CAT-6","mant_fecha":"-","mant_tipo":"-","fallas":"FALLA DE MOUSE SCROLL, PC FALTA DE MANTENIMIENTO","solucion":""},{"id":"pc016","codigo":"LAB-P5-206 / 016","ubicacion":"FILA 5 - PC16","usuario":"Alumno","estado":"operativo","cpu_marca":"Intel","cpu_modelo":"INTEL CORE I7 - 4770","cpu_ghz":"3.40 GHz","ram_cap":"8 GB","ram_tipo":"DDR3","grafica":"2 GB","hdd_tipo":"SSD","hdd_cap":"240GB","monitor_marca":"Samsung","monitor_tam":"19\"","monitor_obs":"","teclado_marca":"Logitech","teclado_estado":"bueno","mouse_marca":"Microsoft","mouse_estado":"regular","ip":"192.168.149.56","gateway":"192.168.150.2","mac":"00:22:4D:B0:EF:9C","puerto_sw":"-","puerto_pp":"-","rack":"-","cable_tipo":"CAT-6","mant_fecha":"-","mant_tipo":"-","fallas":"FALLA DE MOUSE SCROLL, PC FALTA DE MANTENIMIENTO","solucion":""},{"id":"pc017","codigo":"LAB-P5-206 / 017","ubicacion":"FILA 5 - PC17","usuario":"Alumno","estado":"operativo","cpu_marca":"Intel","cpu_modelo":"INTEL CORE I7 - 4770","cpu_ghz":"3.40 GHz","ram_cap":"8 GB","ram_tipo":"DDR3","grafica":"2 GB","hdd_tipo":"SSD","hdd_cap":"240GB","monitor_marca":"Samsung","monitor_tam":"19\"","monitor_obs":"","teclado_marca":"Microsoft","teclado_estado":"bueno","mouse_marca":"Microsoft","mouse_estado":"regular","ip":"192.168.149.57","gateway":"192.168.150.2","mac":"00:22:4D:B0:ED:7F","puerto_sw":"-","puerto_pp":"38B/D","rack":"-","cable_tipo":"CAT-6","mant_fecha":"-","mant_tipo":"-","fallas":"FALLA DE MOUSE SCROLL, PC FALTA DE MANTENIMIENTO","solucion":""},{"id":"pc018","codigo":"LAB-P5-206 / 018","ubicacion":"FILA 5 - PC18","usuario":"Alumno","estado":"operativo","cpu_marca":"Intel","cpu_modelo":"INTEL CORE I7 - 4770","cpu_ghz":"3.40 GHz","ram_cap":"8 GB","ram_tipo":"DDR3","grafica":"2 GB","hdd_tipo":"SSD","hdd_cap":"240GB","monitor_marca":"Samsung","monitor_tam":"19\"","monitor_obs":"","teclado_marca":"Logitech","teclado_estado":"bueno","mouse_marca":"Microsoft","mouse_estado":"falla","ip":"192.168.149.58","gateway":"192.168.150.2","mac":"00:22:4D:B0:E4:E7","puerto_sw":"-","puerto_pp":"39B/D","rack":"-","cable_tipo":"CAT-6","mant_fecha":"-","mant_tipo":"-","fallas":"FALLA DE MOUSE SCROLL, PC FALTA DE MANTENIMIENTO","solucion":""},{"id":"pc019","codigo":"LAB-P5-206 / 019","ubicacion":"FILA 6 - PC19","usuario":"Alumno","estado":"operativo","cpu_marca":"Intel","cpu_modelo":"INTEL CORE I7 - 4770","cpu_ghz":"3.40 GHz","ram_cap":"8 GB","ram_tipo":"DDR3","grafica":"2 GB","hdd_tipo":"SSD","hdd_cap":"240GB","monitor_marca":"Samsung","monitor_tam":"19\"","monitor_obs":"","teclado_marca":"Microsoft","teclado_estado":"bueno","mouse_marca":"Microsoft","mouse_estado":"falla","ip":"192.168.149.59","gateway":"192.168.150.2","mac":"00:22:4D:B0:EC:91","puerto_sw":"-","puerto_pp":"43B/D","rack":"-","cable_tipo":"CAT-6","mant_fecha":"-","mant_tipo":"-","fallas":"FALLA DE MOUSE SCROLL, PC FALTA DE MANTENIMIENTO","solucion":""},{"id":"pc020","codigo":"LAB-P5-206 / 020","ubicacion":"FILA 6 - PC20","usuario":"Alumno","estado":"operativo","cpu_marca":"Intel","cpu_modelo":"INTEL CORE I7 - 4770","cpu_ghz":"3.40 GHz","ram_cap":"8 GB","ram_tipo":"DDR3","grafica":"2 GB","hdd_tipo":"SSD","hdd_cap":"240GB","monitor_marca":"Samsung","monitor_tam":"19\"","monitor_obs":"","teclado_marca":"Microsoft","teclado_estado":"bueno","mouse_marca":"Microsoft","mouse_estado":"regular","ip":"192.168.149.60","gateway":"192.168.150.2","mac":"00:22:4D:B0:E5:98","puerto_sw":"-","puerto_pp":"44B/D","rack":"-","cable_tipo":"CAT-6","mant_fecha":"-","mant_tipo":"-","fallas":"FALLA DE MOUSE SCROLL, PC FALTA DE MANTENIMIENTO","solucion":""},{"id":"pc021","codigo":"LAB-P5-206 / 021","ubicacion":"FILA 6 - PC21","usuario":"Alumno","estado":"operativo","cpu_marca":"Intel","cpu_modelo":"INTEL CORE I7 - 4770","cpu_ghz":"3.40 GHz","ram_cap":"8 GB","ram_tipo":"DDR3","grafica":"2 GB","hdd_tipo":"SSD","hdd_cap":"240GB","monitor_marca":"Samsung","monitor_tam":"19\"","monitor_obs":"","teclado_marca":"Microsoft","teclado_estado":"bueno","mouse_marca":"Microsoft","mouse_estado":"regular","ip":"192.168.149.61","gateway":"192.168.150.2","mac":"00:22:4D:B0:E5:23","puerto_sw":"-","puerto_pp":"-","rack":"-","cable_tipo":"CAT-6","mant_fecha":"-","mant_tipo":"-","fallas":"FALLA DE MOUSE SCROLL, PC FALTA DE MANTENIMIENTO","solucion":""},{"id":"pc022","codigo":"LAB-P5-206 / 022","ubicacion":"FILA 6 - PC22","usuario":"Alumno","estado":"operativo","cpu_marca":"Intel","cpu_modelo":"INTEL CORE I7 - 4770","cpu_ghz":"3.40 GHz","ram_cap":"8 GB","ram_tipo":"DDR3","grafica":"2 GB","hdd_tipo":"SSD","hdd_cap":"240GB","monitor_marca":"Samsung","monitor_tam":"19\"","monitor_obs":"","teclado_marca":"Microsoft","teclado_estado":"bueno","mouse_marca":"Microsoft","mouse_estado":"falla","ip":"192.168.149.62","gateway":"192.168.150.2","mac":"00:22:4D:B0:E7:23","puerto_sw":"-","puerto_pp":"-","rack":"-","cable_tipo":"CAT-6","mant_fecha":"-","mant_tipo":"-","fallas":"FALLA DE MOUSE SCROLL, PC FALTA DE MANTENIMIENTO","solucion":""},{"id":"pc023","codigo":"LAB-P5-206 / 023","ubicacion":"FILA 7 - PC23","usuario":"Alumno","estado":"operativo","cpu_marca":"Intel","cpu_modelo":"INTEL CORE I7 - 4770","cpu_ghz":"3.40 GHz","ram_cap":"8 GB","ram_tipo":"DDR3","grafica":"2 GB","hdd_tipo":"SSD","hdd_cap":"240GB","monitor_marca":"Samsung","monitor_tam":"19\"","monitor_obs":"","teclado_marca":"Microsoft","teclado_estado":"bueno","mouse_marca":"Microsoft","mouse_estado":"regular","ip":"192.168.149.63","gateway":"192.168.150.2","mac":"00:22:4D:B0:E7:27","puerto_sw":"-","puerto_pp":"46B/D","rack":"-","cable_tipo":"CAT-6","mant_fecha":"-","mant_tipo":"-","fallas":"FALLA DE MOUSE SCROLL, PC FALTA DE MANTENIMIENTO","solucion":""},{"id":"pc024","codigo":"LAB-P5-206 / 024","ubicacion":"FILA 7 - PC24","usuario":"Alumno","estado":"operativo","cpu_marca":"Intel","cpu_modelo":"INTEL CORE I7 - 4770","cpu_ghz":"3.40 GHz","ram_cap":"8 GB","ram_tipo":"DDR3","grafica":"2 GB","hdd_tipo":"SSD","hdd_cap":"240GB","monitor_marca":"Samsung","monitor_tam":"19\"","monitor_obs":"","teclado_marca":"Microsoft","teclado_estado":"bueno","mouse_marca":"Microsoft","mouse_estado":"regular","ip":"192.168.149.64","gateway":"192.168.150.2","mac":"00:22:4D:B0:EC:16","puerto_sw":"-","puerto_pp":"47B/D","rack":"-","cable_tipo":"CAT-6","mant_fecha":"-","mant_tipo":"-","fallas":"FALLA DE MOUSE SCROLL, PC FALTA DE MANTENIMIENTO","solucion":""},{"id":"pc025","codigo":"LAB-P5-206 / 025","ubicacion":"FILA 7 - PC25","usuario":"Alumno","estado":"operativo","cpu_marca":"Intel","cpu_modelo":"INTEL CORE I7 - 4770","cpu_ghz":"3.40 GHz","ram_cap":"8 GB","ram_tipo":"DDR3","grafica":"2 GB","hdd_tipo":"SSD","hdd_cap":"240GB","monitor_marca":"Samsung","monitor_tam":"19\"","monitor_obs":"","teclado_marca":"Microsoft","teclado_estado":"bueno","mouse_marca":"Microsoft","mouse_estado":"falla","ip":"192.168.149.65","gateway":"192.168.150.2","mac":"00:22:4D:B0:EE:A3","puerto_sw":"-","puerto_pp":"45B/D","rack":"-","cable_tipo":"CAT-6","mant_fecha":"-","mant_tipo":"-","fallas":"FALLA DE MOUSE SCROLL, PC FALTA DE MANTENIMIENTO","solucion":""},{"id":"pc026","codigo":"LAB-P5-206 / 026","ubicacion":"FILA 8 - PC26","usuario":"Alumno","estado":"operativo","cpu_marca":"Intel","cpu_modelo":"INTEL CORE I7 - 4770","cpu_ghz":"3.40 GHz","ram_cap":"8 GB","ram_tipo":"DDR3","grafica":"2 GB","hdd_tipo":"SSD","hdd_cap":"240GB","monitor_marca":"Samsung","monitor_tam":"19\"","monitor_obs":"","teclado_marca":"Microsoft","teclado_estado":"bueno","mouse_marca":"Microsoft","mouse_estado":"regular","ip":"192.168.149.66","gateway":"192.168.150.2","mac":"00:22:4D:B0:E6:44","puerto_sw":"-","puerto_pp":"49B/D","rack":"-","cable_tipo":"CAT-6","mant_fecha":"-","mant_tipo":"-","fallas":"FALLA DE MOUSE SCROLL, PC FALTA DE MANTENIMIENTO","solucion":""},{"id":"pc027","codigo":"LAB-P5-206 / 027","ubicacion":"FILA 8 - PC27","usuario":"Alumno","estado":"operativo","cpu_marca":"Intel","cpu_modelo":"INTEL CORE I7 - 4770","cpu_ghz":"3.40 GHz","ram_cap":"8 GB","ram_tipo":"DDR3","grafica":"2 GB","hdd_tipo":"SSD","hdd_cap":"240GB","monitor_marca":"Samsung","monitor_tam":"19\"","monitor_obs":"","teclado_marca":"Microsoft","teclado_estado":"bueno","mouse_marca":"Microsoft","mouse_estado":"falla","ip":"192.168.149.67","gateway":"192.168.150.2","mac":"00:22:4D:B0:E9:99","puerto_sw":"-","puerto_pp":"50B/D","rack":"-","cable_tipo":"CAT-6","mant_fecha":"-","mant_tipo":"-","fallas":"FALLA DE MOUSE SCROLL, PC FALTA DE MANTENIMIENTO","solucion":""},{"id":"pc028","codigo":"LAB-P5-206 / 028","ubicacion":"FILA 8 - PC28","usuario":"Alumno","estado":"falla","cpu_marca":"Intel","cpu_modelo":"INTEL CORE I7 - 4770","cpu_ghz":"3.40 GHz","ram_cap":"8 GB","ram_tipo":"DDR3","grafica":"2 GB","hdd_tipo":"SSD","hdd_cap":"240GB","monitor_marca":"Samsung","monitor_tam":"19\"","monitor_obs":"","teclado_marca":"-","teclado_estado":"bueno","mouse_marca":"-","mouse_estado":"bueno","ip":"192.168.149.68","gateway":"192.168.150.2","mac":"","puerto_sw":"-","puerto_pp":"48B/D","rack":"-","cable_tipo":"CAT-6","mant_fecha":"-","mant_tipo":"-","fallas":"CPU NO DA VIDEO ‚Äî No enciende monitor","solucion":""},{"id":"pc029","codigo":"LAB-P5-206 / 029","ubicacion":"FILA 9 - PC29","usuario":"Alumno","estado":"operativo","cpu_marca":"Intel","cpu_modelo":"INTEL CORE I7 - 4770","cpu_ghz":"3.40 GHz","ram_cap":"8 GB","ram_tipo":"DDR3","grafica":"2 GB","hdd_tipo":"SSD","hdd_cap":"240GB","monitor_marca":"Samsung","monitor_tam":"19\"","monitor_obs":"","teclado_marca":"Microsoft","teclado_estado":"bueno","mouse_marca":"Microsoft","mouse_estado":"regular","ip":"192.168.149.69","gateway":"192.168.150.2","mac":"00:22:4D:B0:EB:C5","puerto_sw":"-","puerto_pp":"52B/D","rack":"-","cable_tipo":"CAT-6","mant_fecha":"-","mant_tipo":"-","fallas":"FALLA DE MOUSE SCROLL, PC FALTA DE MANTENIMIENTO","solucion":""},{"id":"pc030","codigo":"LAB-P5-206 / 030","ubicacion":"FILA 9 - PC30","usuario":"Alumno","estado":"operativo","cpu_marca":"Intel","cpu_modelo":"INTEL CORE I7 - 4770","cpu_ghz":"3.40 GHz","ram_cap":"8 GB","ram_tipo":"DDR3","grafica":"2 GB","hdd_tipo":"SSD","hdd_cap":"240GB","monitor_marca":"Samsung","monitor_tam":"19\"","monitor_obs":"","teclado_marca":"Microsoft","teclado_estado":"bueno","mouse_marca":"Microsoft","mouse_estado":"falla","ip":"192.168.149.70","gateway":"192.168.150.2","mac":"00:22:4D:B0:E7:53","puerto_sw":"-","puerto_pp":"53B/D","rack":"-","cable_tipo":"CAT-6","mant_fecha":"-","mant_tipo":"-","fallas":"FALLA DE MOUSE SCROLL, PC FALTA DE MANTENIMIENTO","solucion":""},{"id":"pc031","codigo":"LAB-P5-206 / 031","ubicacion":"FILA 9 - PC31","usuario":"Alumno","estado":"operativo","cpu_marca":"Intel","cpu_modelo":"INTEL CORE I7 - 4770","cpu_ghz":"3.40 GHz","ram_cap":"8 GB","ram_tipo":"DDR3","grafica":"2 GB","hdd_tipo":"SSD","hdd_cap":"240GB","monitor_marca":"Samsung","monitor_tam":"19\"","monitor_obs":"","teclado_marca":"Logitech","teclado_estado":"bueno","mouse_marca":"Microsoft","mouse_estado":"falla","ip":"192.168.149.71","gateway":"192.168.150.2","mac":"00:22:4D:B0:EA:79","puerto_sw":"-","puerto_pp":"54B/D","rack":"-","cable_tipo":"CAT-6","mant_fecha":"-","mant_tipo":"-","fallas":"FALLA DE MOUSE SCROLL, PC FALTA DE MANTENIMIENTO","solucion":""},{"id":"pc032","codigo":"LAB-P5-206 / 032","ubicacion":"PRINCIPAL - PC32","usuario":"Docente","estado":"operativo","cpu_marca":"Intel","cpu_modelo":"INTEL CORE I9 - 12900KF","cpu_ghz":"3.20 GHz","ram_cap":"16 GB","ram_tipo":"DDR4","grafica":"16 GB","hdd_tipo":"-","hdd_cap":"-","monitor_marca":"Samsung","monitor_tam":"24\"","monitor_obs":"","teclado_marca":"Microsoft","teclado_estado":"bueno","mouse_marca":"Microsoft","mouse_estado":"regular","ip":"192.168.149.72","gateway":"192.168.150.2","mac":"D8:5E:D3:42:FB:AE","puerto_sw":"-","puerto_pp":"37B/D","rack":"-","cable_tipo":"CAT-6","mant_fecha":"-","mant_tipo":"-","fallas":"FALLA DE MOUSE SCROLL","solucion":""}];

function load(){
  try{const r=localStorage.getItem(STORE);equipos=r?JSON.parse(r):[];}catch{equipos=[];}
  if(!equipos.length){equipos=JSON.parse(JSON.stringify(DATA));save();return;}
  // Migraci√≥n: sincronizar campos de red desde DATA (puerto_pp, puerto_sw, rack, cable_tipo)
  // Actualiza si el campo est√° ausente o si en DATA hay un valor real y en localStorage hay '-'
  const SYNC=['puerto_pp','puerto_sw','rack','cable_tipo'];
  let changed=false;
  equipos.forEach(eq=>{
    const src=DATA.find(d=>d.id===eq.id);
    if(!src)return;
    SYNC.forEach(f=>{
      if(eq[f]===undefined||eq[f]===null||(eq[f]==='-'&&src[f]&&src[f]!=='-')){
        eq[f]=src[f];changed=true;
      }
    });
  });
  if(changed)save();
}
function save(){localStorage.setItem(STORE,JSON.stringify(equipos));}
function gid(){return 'eq_'+Date.now().toString(36)+Math.random().toString(36).slice(2,6);}

// ‚îÄ‚îÄ SEVERITY ‚îÄ‚îÄ
function getSev(e){
  const f=(e.fallas||'').toUpperCase();
  if(e.estado==='falla'||f.includes('NO DA VIDEO')||f.includes('NO ENCIENDE')||f.includes('NO ARRANCA')) return 'crit';
  if(f.includes('RAYAS')||e.monitor_obs==='Con rayas') return 'alto';
  if(e.mouse_estado==='falla'||e.teclado_estado==='falla') return 'medio';
  if(e.mouse_estado==='regular'||e.teclado_estado==='regular') return 'bajo';
  if(!f||f==='-') return 'ok';
  return 'bajo';
}
const SEV_CFG={
  crit:{cls:'sev-crit',dot:'sev-dot-crit',label:'üî¥ CR√çTICO',desc:'CPU sin video / no enciende'},
  alto:{cls:'sev-alto',dot:'sev-dot-alto',label:'üü† ALTO',desc:'Pantalla con rayas'},
  medio:{cls:'sev-medio',dot:'sev-dot-medio',label:'üü° MEDIO',desc:'Perif√©rico con falla'},
  bajo:{cls:'sev-bajo',dot:'sev-dot-bajo',label:'üü§ BAJO',desc:'Perif√©rico con funcionamiento regular'},
  ok:{cls:'sev-ok',dot:'sev-dot-ok',label:'üü¢ SIN FALLAS',desc:'Equipo operativo sin observaciones'},
};
function sevBadge(e){const s=getSev(e);const c=SEV_CFG[s];return `<span class="badge ${c.cls}" style="font-size:10px;"><span style="width:5px;height:5px;border-radius:50%;${c.dot.includes('dot-')?' ':''}display:inline-block;margin-right:4px;background:currentColor;opacity:.8;"></span>${c.label}</span>`;}

// ‚îÄ‚îÄ IP FORMATTER ‚îÄ‚îÄ
function fmtIP(ip){if(!ip)return'‚Äî';const p=ip.split('.');if(p.length!==4)return ip;
  return`<span class="ip-wrap"><span class="ip-oct">${p[0]}.${p[1]}.${p[2]}.</span><span class="ip-last">${p[3]}</span></span>`;}

// ‚îÄ‚îÄ STATUS BADGES ‚îÄ‚îÄ
function stBadge(est){const m={operativo:'b-green',falla:'b-red',mantenimiento:'b-amber'};const l={operativo:'OPERATIVO',falla:'FALLA',mantenimiento:'MANTENIMIENTO'};return`<span class="badge ${m[est]||'b-cyan'}">${l[est]||est.toUpperCase()}</span>`;}
function perBadge(e){const m={bueno:'b-green',regular:'b-amber',falla:'b-red'};return`<span class="badge ${m[e]||'b-cyan'}">${e.toUpperCase()}</span>`;}

function toast(msg,type='info'){const box=document.getElementById('toast-box');const el=document.createElement('div');el.className=`toast ${type}`;el.innerHTML=`<span>${msg}</span>`;box.appendChild(el);setTimeout(()=>el.remove(),3500);}
function toggleMob(){document.getElementById('mobile-nav').classList.toggle('open');}

// ‚ïê‚ïê VIEWS ‚ïê‚ïê
function showView(name){
  document.querySelectorAll('.view').forEach(v=>v.classList.remove('active'));
  document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
  document.getElementById('view-'+name).classList.add('active');
  const nb=document.getElementById('nav-'+name);if(nb)nb.classList.add('active');
  if(name==='dashboard')renderDash();
  if(name==='equipos'){curPage=1;renderEq();}
  if(name==='mapa')renderMapa();
  if(name==='reportes')renderReportes();
  if(name==='autores')document.getElementById('aut-total').textContent=equipos.length+' equipos registrados';
}

// ‚ïê‚ïê DASHBOARD ‚ïê‚ïê
function renderDash(){
  const tot=equipos.length, ok=equipos.filter(e=>e.estado==='operativo').length;
  const fa=equipos.filter(e=>e.estado==='falla').length;
  const mnt=equipos.filter(e=>e.estado==='mantenimiento').length;
  const mFa=equipos.filter(e=>e.mouse_estado==='falla').length;
  const mReg=equipos.filter(e=>e.mouse_estado==='regular').length;
  const critN=equipos.filter(e=>getSev(e)==='crit').length;
  document.getElementById('dash-stats').innerHTML=`
    <div class="stat c-cyan"><div class="stat-label">TOTAL EQUIPOS</div><div class="stat-val">${tot}</div><div class="stat-sub">Laboratorio P5-206</div><div class="stat-icon">üñ•Ô∏è</div></div>
    <div class="stat c-green"><div class="stat-label">CPU OPERATIVOS</div><div class="stat-val">${ok}</div><div class="stat-sub">${ok}/32 ¬∑ ${Math.round(ok/tot*100)}% funcional</div><div class="stat-icon">‚úÖ</div></div>
    <div class="stat c-red"><div class="stat-label">CR√çTICOS</div><div class="stat-val">${critN}</div><div class="stat-sub">Requieren atenci√≥n urgente</div><div class="stat-icon">üö®</div></div>
    <div class="stat c-orange"><div class="stat-label">MOUSE FALLA</div><div class="stat-val">${mFa}</div><div class="stat-sub">${mReg} en estado regular</div><div class="stat-icon">üñ±Ô∏è</div></div>
    <div class="stat c-amber"><div class="stat-label">PERIF√âRICOS</div><div class="stat-val">${mFa+mReg}</div><div class="stat-sub">Con alguna observaci√≥n</div><div class="stat-icon">‚ö†Ô∏è</div></div>
    <div class="stat c-blue"><div class="stat-label">RED LAN</div><div class="stat-val">32</div><div class="stat-sub">Nodos ¬∑ 192.168.149.x</div><div class="stat-icon">üì°</div></div>
  `;
  const sevGroups={crit:[],alto:[],medio:[],bajo:[],ok:[]};
  equipos.forEach(e=>sevGroups[getSev(e)].push(e));
  let obsHTML='';
  ['crit','alto','medio','bajo'].forEach(s=>{
    const list=sevGroups[s];if(!list.length)return;
    const c=SEV_CFG[s];
    obsHTML+=`<div style="margin-bottom:18px;">
      <div style="display:flex;align-items:center;gap:10px;margin-bottom:10px;">
        <span style="font-family:var(--mono);font-size:12px;font-weight:700;">${c.label}</span>
        <span style="font-family:var(--mono);font-size:10px;color:var(--text3);">${c.desc} ¬∑ ${list.length} equipo${list.length>1?'s':''}</span>
      </div>
      <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:8px;">
        ${list.map(e=>`
          <div class="${c.cls}" style="border-radius:8px;padding:10px 12px;cursor:pointer;transition:opacity .2s;" onclick="showDetail('${e.id}')" onmouseenter="this.style.opacity='.85'" onmouseleave="this.style.opacity='1'">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:4px;">
              <span style="font-family:var(--mono);font-size:10px;font-weight:700;">${e.codigo}</span>
              ${stBadge(e.estado)}
            </div>
            <div style="font-size:11px;opacity:.8;margin-bottom:3px;">${e.ubicacion}</div>
            <div style="font-size:10px;opacity:.7;font-style:italic;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;">${e.fallas}</div>
          </div>`).join('')}
      </div>
    </div>`;
  });
  document.getElementById('dash-obs').innerHTML=`
    <div style="font-family:var(--head);font-size:16px;font-weight:700;letter-spacing:1.5px;margin-bottom:16px;color:var(--text);">
      CLASIFICACI√ìN POR SEVERIDAD
      <span style="font-size:12px;font-weight:400;color:var(--text3);margin-left:8px;">Perif√©ricos: ${mFa+mReg} con observaciones ¬∑ CPU: ${fa}/32 con falla cr√≠tica</span>
    </div>
    ${obsHTML}`;
}

// ‚ïê‚ïê EQUIPOS ‚ïê‚ïê
function getFiltered(){
  const q=(document.getElementById('s-inp')?.value||'').toLowerCase();
  const est=document.getElementById('f-estado')?.value||'all';
  const fila=document.getElementById('f-fila')?.value||'all';
  const sev=document.getElementById('f-sev')?.value||'all';
  return equipos.filter(e=>{
    const str=[e.codigo,e.ubicacion,e.ip,e.mac,e.usuario,e.cpu_modelo,e.fallas].join(' ').toLowerCase();
    if(q&&!str.includes(q))return false;
    if(est!=='all'&&e.estado!==est)return false;
    if(fila!=='all'&&!e.ubicacion.includes(fila))return false;
    if(sev!=='all'&&getSev(e)!==sev)return false;
    return true;
  });
}
function setVM(m){vm=m;document.getElementById('vt-grid').classList.toggle('active',m==='grid');document.getElementById('vt-tbl').classList.toggle('active',m==='table');renderEq();}
function renderEq(){
  const list=getFiltered(),tot=list.length;
  const pages=Math.max(1,Math.ceil(tot/PER));
  curPage=Math.min(curPage,pages);
  const slice=list.slice((curPage-1)*PER,curPage*PER);
  document.getElementById('eq-label').textContent=`${tot} EQUIPO${tot!==1?'S':''} ¬∑ LABORATORIO P5-206`;
  const cont=document.getElementById('eq-cont');
  if(!slice.length){cont.innerHTML=`<div class="empty"><div class="empty-icon">üîç</div><div class="empty-text">Sin resultados</div></div>`;document.getElementById('pager').innerHTML='';return;}
  cont.innerHTML=vm==='grid'?`<div class="card-grid">${slice.map(cardH).join('')}</div>`:tableH(slice);
  // pager
  const pager=document.getElementById('pager');
  if(pages<=1){pager.innerHTML='';return;}
  const fr=(curPage-1)*PER+1,to=Math.min(curPage*PER,tot);
  let btns='';for(let i=1;i<=pages;i++)btns+=`<button class="pg-btn${i===curPage?' active':''}" onclick="goP(${i})">${i}</button>`;
  pager.innerHTML=`<span class="pager-info">Mostrando ${fr}‚Äì${to} de ${tot}</span><div class="pager-btns"><button class="pg-btn" onclick="goP(${curPage-1})" ${curPage===1?'disabled':''}>‚Äπ</button>${btns}<button class="pg-btn" onclick="goP(${curPage+1})" ${curPage===pages?'disabled':''}>‚Ä∫</button></div>`;
}
function goP(p){curPage=p;renderEq();window.scrollTo({top:0,behavior:'smooth'});}

function cardH(e){
  const s=getSev(e),sc=SEV_CFG[s];
  return`<div class="eq-card e-${e.estado}" onclick="showDetail('${e.id}')">
    <div class="card-head">
      <div><div class="card-code">${e.codigo}</div><div class="card-loc">${e.ubicacion} ¬∑ ${e.usuario}</div></div>
      ${stBadge(e.estado)}
    </div>
    <div class="card-body">
      <div class="card-spec"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="4" y="4" width="16" height="16" rx="2"/><line x1="9" y1="1" x2="9" y2="4"/><line x1="15" y1="1" x2="15" y2="4"/><line x1="9" y1="20" x2="9" y2="23"/><line x1="15" y1="20" x2="15" y2="23"/><line x1="20" y1="9" x2="23" y2="9"/><line x1="20" y1="14" x2="23" y2="14"/><line x1="1" y1="9" x2="4" y2="9"/><line x1="1" y1="14" x2="4" y2="14"/></svg><span><strong>${e.cpu_modelo}</strong> ¬∑ ${e.cpu_ghz}</span></div>
      <div class="card-spec"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="6" width="20" height="12" rx="2"/><line x1="6" y1="10" x2="6" y2="14"/><line x1="10" y1="10" x2="10" y2="14"/><line x1="14" y1="10" x2="14" y2="14"/><line x1="18" y1="10" x2="18" y2="14"/></svg><span><strong>${e.ram_cap} ${e.ram_tipo}</strong> ¬∑ GPU: ${e.grafica||'‚Äî'}</span></div>
      <div class="card-spec"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2"/><path d="M8 21h8M12 17v4"/></svg><span>${e.monitor_marca} ${e.monitor_tam}${e.monitor_obs?' ‚ö†Ô∏è':''}</span></div>
      <div class="card-spec" style="font-family:var(--mono);font-size:11px;">${fmtIP(e.ip)}</div>
      ${e.fallas&&e.fallas!=='-'?`<div class="falla-chip ${sc.cls}" title="${e.fallas}">‚ö† ${e.fallas}</div>`:''}
    </div>
    <div class="card-foot">
      <div>${sevBadge(e)}</div>
      <div class="card-actions" onclick="event.stopPropagation()">
        <button class="btn btn-cyan btn-xs" onclick="showDetail('${e.id}')">VER</button>
        <button class="btn btn-ghost btn-xs" onclick="openModal('${e.id}')">‚úè</button>
        <button class="btn btn-danger btn-xs" onclick="delEq('${e.id}')">‚úï</button>
      </div>
    </div>
  </div>`;
}

function tableH(list){
  return`<div class="tbl-wrap"><table><thead><tr><th>C√≥digo</th><th>Ubicaci√≥n</th><th>Estado CPU</th><th>CPU</th><th>RAM / GPU</th><th>IP (√∫ltimo octeto)</th><th>MAC</th><th>Patch Panel</th><th>Mouse</th><th>Severidad</th><th>Acciones</th></tr></thead><tbody>
    ${list.map(e=>`<tr>
      <td><span class="td-mono" style="color:var(--cyan);font-size:10px;">${e.codigo}</span></td>
      <td class="td-bold">${e.ubicacion}</td>
      <td>${stBadge(e.estado)}</td>
      <td style="font-size:11px;">${e.cpu_modelo}</td>
      <td style="font-size:11px;">${e.ram_cap} ¬∑ ${e.grafica||'‚Äî'}</td>
      <td>${fmtIP(e.ip)}</td>
      <td class="td-mono" style="font-size:10px;">${e.mac||'‚Äî'}</td>
      <td class="td-mono" style="font-size:11px;color:rgba(255,200,100,.9);font-weight:700;">${e.puerto_pp&&e.puerto_pp!=='-'?e.puerto_pp:'‚Äî'}</td>
      <td>${perBadge(e.mouse_estado)}</td>
      <td>${sevBadge(e)}</td>
      <td><div style="display:flex;gap:4px;"><button class="btn btn-cyan btn-xs" onclick="showDetail('${e.id}')">VER</button><button class="btn btn-ghost btn-xs" onclick="openModal('${e.id}')">‚úè</button><button class="btn btn-danger btn-xs" onclick="delEq('${e.id}')">‚úï</button></div></td>
    </tr>`).join('')}
  </tbody></table></div>`;
}

// ‚ïê‚ïê MAPA RED ‚ïê‚ïê
// ‚ïê‚ïê TOOLTIP ‚ïê‚ïê
function fpShowTip(ev,id){
  const e=equipos.find(x=>x.id===id);if(!e)return;
  const s=getSev(e),sc=SEV_CFG[s];
  const t=document.getElementById('fp-tip');
  if(!t)return;
  t.innerHTML=`
    <div class="fp-tip-code">üìã ${e.codigo}</div>
    <div class="fp-tip-row"><span class="fp-tip-l">Estado CPU</span><span class="fp-tip-v">${stBadge(e.estado)}</span></div>
    <div class="fp-tip-row"><span class="fp-tip-l">CPU</span><span class="fp-tip-v" style="font-size:9px;">${e.cpu_modelo}</span></div>
    <div class="fp-tip-row"><span class="fp-tip-l">RAM / GPU</span><span class="fp-tip-v mono">${e.ram_cap} ${e.ram_tipo} / ${e.grafica||'‚Äî'}</span></div>
    <div class="fp-tip-row"><span class="fp-tip-l">IP</span><span class="fp-tip-v mono">${fmtIP(e.ip)}</span></div>
    <div class="fp-tip-row"><span class="fp-tip-l">Patch Panel</span><span class="fp-tip-v mono" style="color:rgba(255,200,100,.9);font-weight:900;">${e.puerto_pp&&e.puerto_pp!=='-'?e.puerto_pp:'‚Äî'}</span></div>
    <div class="fp-tip-row"><span class="fp-tip-l">MAC</span><span class="fp-tip-v mono" style="font-size:9px;">${e.mac||'‚Äî'}</span></div>
    <div class="fp-tip-row"><span class="fp-tip-l">Mouse</span><span class="fp-tip-v">${perBadge(e.mouse_estado)}</span></div>
    <div class="fp-tip-row"><span class="fp-tip-l">Monitor</span><span class="fp-tip-v">${e.monitor_obs?'<span style="color:var(--amber);">‚ö† '+e.monitor_obs+'</span>':'OK'}</span></div>
    <div class="fp-tip-row"><span class="fp-tip-l">Severidad</span><span class="fp-tip-v">${sevBadge(e)}</span></div>
    ${e.fallas&&e.fallas!=='-'?'<div style="margin-top:6px;padding:5px 8px;border-radius:5px;font-size:9px;" class="'+sc.cls+'">‚ö† '+e.fallas.substring(0,90)+(e.fallas.length>90?'‚Ä¶':'')+'</div>':''}
    <div style="text-align:center;margin-top:7px;font-family:var(--mono);font-size:9px;color:var(--text3);">Clic ‚Üí ficha t√©cnica completa</div>
  `;
  t.classList.add('on');
  fpMoveTip(ev);
}
function fpMoveTip(ev){
  const t=document.getElementById('fp-tip');if(!t)return;
  const vw=window.innerWidth,vh=window.innerHeight;
  const tw=t.offsetWidth||240,th=t.offsetHeight||200;
  let x=ev.clientX+16,y=ev.clientY+16;
  if(x+tw>vw-8)x=ev.clientX-tw-14;
  if(y+th>vh-8)y=ev.clientY-th-14;
  t.style.left=x+'px';t.style.top=y+'px';
}
function fpHideTip(){const t=document.getElementById('fp-tip');if(t)t.classList.remove('on');}

function renderMapa(){
  function getPC(n){
    const pad=String(n).padStart(2,'0');
    return equipos.find(e=>e.ubicacion&&(
      e.ubicacion.includes('PC'+pad)||
      e.ubicacion.toUpperCase().includes('PC'+n+' ')||
      e.ubicacion.toUpperCase().endsWith('PC'+n)||
      e.ubicacion.toUpperCase().includes('PC0'+n)
    ));
  }
  const tot=equipos.length;
  const ok=equipos.filter(e=>e.estado==='operativo').length;
  const fa=equipos.filter(e=>e.estado==='falla').length;
  const mFa=equipos.filter(e=>e.mouse_estado==='falla').length;
  const mReg=equipos.filter(e=>e.mouse_estado==='regular').length;
  const withMac=equipos.filter(e=>e.mac&&e.mac.trim()).length;

  const C={
    top:'#00d4ff',fl2:'#ef4444',fl3:'#d946ef',fl4:'#f97316',bot:'#f59e0b',
    fr1:'#22c55e',fr2:'#fb923c',fr3:'#3b82f6',fr4:'#eab308',fr5:'#4f83f1',fr6:'#84cc16',
  };
  const PC_C={
    2:C.top,3:C.top,4:C.top,
    1:C.fl2,5:C.fl2,6:C.fl2,
    7:C.fl3,8:C.fl3,9:C.fl3,
    10:C.fl4,11:C.fl4,12:C.fl4,
    13:C.bot,14:C.bot,15:C.bot,
    32:C.fr1,17:C.fr1,18:C.fr1,
    16:C.fr2,21:C.fr2,22:C.fr2,
    19:C.fr3,20:C.fr3,25:C.fr3,
    23:C.fr4,24:C.fr4,28:C.fr4,
    26:C.fr5,27:C.fr5,
    29:C.fr6,30:C.fr6,31:C.fr6,
  };

  // Chess board: (row,col) ‚Üí PC number   [6 rows √ó 10 cols]
  // Columnas 5 y 6 = PASADIZO CENTRAL (siempre vac√≠as)
  // Zona izquierda: cols 1-4  |  Pasadizo: cols 5-6  |  Zona derecha: cols 7-10
  const BOARD={};
  function p(r,c,n){BOARD[r+','+c]=n;}

  // FILA 1: Puerta principal (col 1), PC32 DOCENTE (col 9)
  p(1,9,32);

  // FILA 2: PC1¬∑2¬∑3¬∑4 (cols 1-4) | pasadizo(5-6) | PC16(col8)¬∑PC17(col9)¬∑PC18(col10)
  p(2,1,1);p(2,2,2);p(2,3,3);p(2,4,4);
  p(2,8,16);p(2,9,17);p(2,10,18);

  // FILA 3: PC5(col1)¬∑PC6(col2)¬∑PC7(col3)¬∑vac√≠o(col4) | pasadizo | PC19(col7)¬∑20¬∑21¬∑22(cols7-10)
  p(3,1,5);p(3,2,6);p(3,3,7);
  p(3,7,19);p(3,8,20);p(3,9,21);p(3,10,22);

  // FILA 4: PC8¬∑9¬∑10¬∑11 (cols 1-4) | pasadizo | PC23¬∑24¬∑25 (cols 8-10)
  p(4,1,8);p(4,2,9);p(4,3,10);p(4,4,11);
  p(4,8,23);p(4,9,24);p(4,10,25);

  // FILA 5: Puerta secundaria (col 1) | pasadizo | PC26¬∑27¬∑28 (cols 8-10)
  p(5,8,26);p(5,9,27);p(5,10,28);

  // FILA 6: PC12¬∑13¬∑14¬∑15 (cols 1-4) | pasadizo | PC29¬∑30¬∑31 (cols 8-10)
  p(6,1,12);p(6,2,13);p(6,3,14);p(6,4,15);
  p(6,8,29);p(6,9,30);p(6,10,31);

  const FP_L={2:[1,5,6],3:[7,8,9],4:[10,11,12]};
  const FP_LC={2:C.fl2,3:C.fl3,4:C.fl4};
  const FP_R={1:[32,17,18],2:[16,21,22],3:[19,20,25],4:[23,24,28],5:[26,27,null],6:[29,30,31]};
  const FP_RC={1:C.fr1,2:C.fr2,3:C.fr3,4:C.fr4,5:C.fr5,6:C.fr6};

  function fpGroup(pcs,color){
    const pinsHTML=pcs.map(n=>n===null
      ?'<div class="fp-pin" style="background:rgba(100,120,150,.2);border:1px dashed rgba(100,120,150,.45);"></div>'
      :'<div class="fp-pin" style="background:'+color+';box-shadow:0 0 4px '+color+'90;"></div>'
    ).join('');
    return '<div class="fp-grp" style="border-color:'+color+'40;width:100%;">'
      +'<div class="fp-pins">'+pinsHTML+'</div>'
      +pcs.map(n=>{
        if(n===null){
          return '<div style="display:flex;align-items:center;gap:3px;padding:3px;opacity:.32;">'
            +'<div class="fp-pin-sm" style="background:rgba(100,120,150,.3);border:1px dashed rgba(100,120,150,.5);"></div>'
            +'<span style="font-family:var(--mono);font-size:7.5px;color:rgba(100,130,160,.6);">SIN CONEX</span>'
            +'</div>';
        }
        const e=getPC(n);
        const ip=e?'.'+e.ip.split('.').pop():'\u2014';
        const pp=e&&e.puerto_pp&&e.puerto_pp!=='-'?e.puerto_pp:'-';
        const dot=e?(e.estado==='operativo'?'var(--green)':e.estado==='falla'?'var(--red)':'var(--amber)'):'var(--text3)';
        const lbl='PC'+String(n).padStart(2,'0');
        return '<div class="fp-entry" onclick="'+(e?"showDetail('"+e.id+"')":'return')+'"'
          +(e?' onmouseenter="fpShowTip(event,\''+e.id+'\') " onmousemove="fpMoveTip(event)" onmouseleave="fpHideTip()"':'')+'>'
          +'<div style="display:flex;align-items:center;gap:3px;">'
          +'<div class="fp-pin-sm" style="background:'+color+';flex-shrink:0;"></div>'
          +'<span class="fp-pc-lbl" style="color:'+color+';">'+lbl+'</span>'
          +'<div class="fp-status-dot" style="background:'+dot+';box-shadow:0 0 4px '+dot+';margin-left:auto;"></div>'
          +'</div>'
          +'<div style="display:flex;align-items:baseline;gap:6px;padding-left:8px;margin-top:1px;">'
          +'<span style="font-family:var(--mono);font-size:10px;color:#ff6b6b;font-weight:900;">'+ip+'</span>'
          +'<span style="font-family:var(--mono);font-size:7.5px;color:rgba(255,200,100,.85);font-weight:700;">'+pp+'</span>'
          +'</div>'
          +'</div>';
      }).join('')
      +'</div>';
  }

  function pcCell(n,r,c){
    const isDark=(r+c)%2===0;
    const e=getPC(n);
    const lbl='PC'+String(n).padStart(2,'0');
    const cc=PC_C[n]||'#888';
    const isDoc=(n===32);
    if(!e){
      return '<div class="cb '+(isDark?'cb-dark':'cb-light')+' cb-pc" style="border-color:'+cc+'30;border-bottom-color:'+cc+'50;opacity:.5;">'
        +'<div class="cp-code" style="color:'+cc+'80;">'+lbl+'</div>'
        +'<div class="cp-icon" style="opacity:.3;">'+(isDoc?'üëë':'üñ•Ô∏è')+'</div>'
        +'</div>';
    }
    const isFa=e.estado==='falla';
    const isOk=e.estado==='operativo';
    const sC=isFa?'var(--red)':isOk?'var(--green)':'var(--amber)';
    const bg=isDark?'rgba(2,14,30,.9)':'rgba(0,35,65,.5)';
    const sev=getSev(e);
    return '<div class="cb cb-pc" style="background:'+bg+';border-color:'+cc+'50;border-bottom:3px solid '+cc+';'
      +(isFa?'box-shadow:inset 0 0 18px rgba(239,68,68,.18);':'')
      +(sev==='crit'?'animation:pulse-crit 2s infinite;':'')
      +'" onclick="showDetail(\''+e.id+'\')"'
      +' onmouseenter="fpShowTip(event,\''+e.id+'\') " onmousemove="fpMoveTip(event)" onmouseleave="fpHideTip()">'
      +(isDoc?'<div style="position:absolute;top:2px;right:3px;font-size:9px;" title="Docente">üëë</div>':'')
      +(isFa?'<div style="position:absolute;top:2px;left:3px;font-size:9px;">üî¥</div>':'')
      +'<div class="cp-code" style="color:'+cc+';">'+lbl+'</div>'
      +'<div class="cp-icon">'+(isDoc?'üë®‚Äçüè´':'üñ•Ô∏è')+'</div>'
      +'<div class="cp-ip">'+'.'+e.ip.split('.').pop()+'</div>'
      +'<div class="cp-dot" style="background:'+sC+';box-shadow:0 0 5px '+sC+';"></div>'
      +'</div>';
  }

  function emptyCell(r,c,sp){
    const isDark=(r+c)%2===0;
    const bg=isDark?'rgba(2,14,30,.9)':'rgba(0,35,65,.45)';
    if(sp==='DOOR_MAIN') return '<div class="cb" style="background:'+bg+';border:1px solid rgba(0,212,255,.05);"><div class="cb-door" style="padding:8px 4px;"><div style="width:30px;height:14px;border:2px solid rgba(200,220,255,.2);border-top:none;border-left:none;border-radius:0 0 16px 0;"></div><span style="font-family:var(--mono);font-size:6px;color:var(--text3);text-align:center;margin-top:2px;display:block;">PUERTA<br>PRINCIPAL</span></div></div>';
    if(sp==='DOOR_SEC') return '<div class="cb" style="background:'+bg+';border:1px solid rgba(0,212,255,.05);"><div class="cb-door" style="padding:8px 4px;"><div style="font-size:16px;">üö™</div><span style="font-family:var(--mono);font-size:6px;color:var(--text3);text-align:center;">PUERTA<br>SEC.</span></div></div>';
    // Pasadizo: columnas 5 y 6
    if(c===5) return '<div class="cb" style="background:rgba(0,5,15,.98);border:1px solid rgba(0,212,255,.02);border-right:none;"></div>';
    if(c===6) return '<div class="cb" style="background:rgba(0,5,15,.98);border:1px solid rgba(0,212,255,.02);border-left:none;"><div style="height:100%;display:flex;align-items:center;justify-content:center;"><div style="display:flex;flex-direction:column;align-items:center;gap:2px;opacity:.2;"><div style="width:1px;height:60%;background:linear-gradient(to bottom,transparent,rgba(0,212,255,.7),transparent);"></div><span style="font-family:var(--mono);font-size:5px;color:rgba(0,212,255,.5);writing-mode:vertical-rl;letter-spacing:2px;">PASADIZO</span></div></div></div>';
    return '<div class="cb" style="background:'+bg+';border:1px solid rgba(0,212,255,.05);"></div>';
  }

  let boardHTML='';
  for(let r=1;r<=6;r++){
    for(let c=1;c<=10;c++){
      const pcN=BOARD[r+','+c];
      if(pcN!=null) boardHTML+=pcCell(pcN,r,c);
      else{
        let sp='';
        if(r===1&&c===1) sp='DOOR_MAIN';
        if(r===5&&c===1) sp='DOOR_SEC';
        boardHTML+=emptyCell(r,c,sp);
      }
    }
  }

  let leftHTML='';
  for(let r=1;r<=6;r++){
    const pcs=FP_L[r];const cc=FP_LC[r];
    leftHTML+='<div class="wall-cell">'+(pcs?fpGroup(pcs,cc):'<div></div>')+'</div>';
  }
  let rightHTML='';
  for(let r=1;r<=6;r++){
    const pcs=FP_R[r];const cc=FP_RC[r];
    rightHTML+='<div class="wall-cell">'+(pcs?fpGroup(pcs,cc):'<div></div>')+'</div>';
  }

  function patchPins(pcs){
    return '<div style="display:flex;gap:3px;padding:4px 8px;background:rgba(5,15,35,.95);border:1px solid rgba(100,140,200,.35);border-radius:6px;box-shadow:0 0 12px rgba(0,0,0,.5);">'
      +pcs.map(n=>'<div style="width:7px;height:20px;background:'+PC_C[n]+';border-radius:2px;box-shadow:0 0 8px '+PC_C[n]+'80;" title="PC'+String(n).padStart(2,'0')+'"></div>').join('')
      +'</div>';
  }

  const svC={crit:0,alto:0,medio:0,bajo:0,ok:0};
  equipos.forEach(e=>svC[getSev(e)]++);

  const rosettes=[
    {label:'Superior ‚Äî PC02¬∑03¬∑04',     pcs:[2,3,4],    color:C.top},
    {label:'Izq. F1 ‚Äî PC01¬∑05¬∑06',      pcs:[1,5,6],    color:C.fl2},
    {label:'Izq. F2 ‚Äî PC07¬∑08¬∑09',      pcs:[7,8,9],    color:C.fl3},
    {label:'Izq. F3 ‚Äî PC10¬∑11¬∑12',      pcs:[10,11,12], color:C.fl4},
    {label:'Inferior ‚Äî PC13¬∑14¬∑15',     pcs:[13,14,15], color:C.bot},
    {label:'Der. F1 ‚Äî PC32¬∑17¬∑18',      pcs:[32,17,18], color:C.fr1},
    {label:'Der. F2 ‚Äî PC16¬∑21¬∑22',      pcs:[16,21,22], color:C.fr2},
    {label:'Der. F3 ‚Äî PC19¬∑20¬∑25',      pcs:[19,20,25], color:C.fr3},
    {label:'Der. F4 ‚Äî PC23¬∑24¬∑28',      pcs:[23,24,28], color:C.fr4},
    {label:'Der. F5 ‚Äî PC26¬∑27',         pcs:[26,27],    color:C.fr5},
    {label:'Der. F6 ‚Äî PC29¬∑30¬∑31',      pcs:[29,30,31], color:C.fr6},
  ];

  const sev_colors={crit:'var(--red)',alto:'var(--orange)',medio:'var(--amber)',bajo:'#eab308',ok:'var(--green)'};

  function canaleInfo(pcs) {
    return pcs.map(n => {
      const e = getPC(n);
      const lbl = 'PC' + String(n).padStart(2,'0');
      const ip  = e ? '.' + e.ip.split('.').pop() : '‚Äî';
      const pp  = e && e.puerto_pp && e.puerto_pp !== '-' ? e.puerto_pp : '‚Äî';
      const col = PC_C[n] || '#888';
      const dot = e ? (e.estado==='operativo'?'var(--green)':e.estado==='falla'?'var(--red)':'var(--amber)') : 'var(--text3)';
      return '<div style="display:flex;flex-direction:column;align-items:center;gap:2px;padding:4px 7px;background:rgba(5,15,35,.9);border:1px solid '+col+'40;border-radius:6px;cursor:pointer;" onclick="'+(e?'showDetail(\''+e.id+'\')':'return')+'" title="'+lbl+'">'
        +'<div style="width:6px;height:6px;border-radius:50%;background:'+dot+';box-shadow:0 0 5px '+dot+';"></div>'
        +'<span style="font-family:var(--mono);font-size:9px;color:'+col+';font-weight:700;">'+lbl+'</span>'
        +'<span style="font-family:var(--mono);font-size:10px;color:#ff6b6b;font-weight:700;">'+ip+'</span>'
        +'<span style="font-family:var(--mono);font-size:8px;color:var(--text2);">'+pp+'</span>'
        +'</div>';
    }).join('');
  }

  document.getElementById('mapa-cont').innerHTML=`
<style>@keyframes pulse-crit{0%,100%{box-shadow:inset 0 0 18px rgba(239,68,68,.18);}50%{box-shadow:inset 0 0 30px rgba(239,68,68,.35),0 0 10px rgba(239,68,68,.2);}}</style>
<div class="chess-outer">
<div>
  <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;flex-wrap:wrap;gap:8px;">
    <div>
      <div style="font-family:var(--head);font-size:18px;font-weight:700;letter-spacing:2px;">üèõÔ∏è PLANO DE RED ‚Äî <span style="color:var(--cyan);">LABORATORIO P5-206</span></div>
      <div style="font-family:var(--mono);font-size:11px;color:var(--text2);margin-top:3px;letter-spacing:.8px;">üìê Tablero 6 filas √ó 10 columnas &nbsp;¬∑&nbsp; UTP CAT-6 &nbsp;¬∑&nbsp; Hover sobre pieza = datos de red</div>
    </div>
    <div style="display:flex;gap:6px;flex-wrap:wrap;">
      <span style="font-family:var(--mono);font-size:12px;background:rgba(34,197,94,.12);border:1px solid rgba(34,197,94,.35);color:var(--green);padding:5px 12px;border-radius:20px;font-weight:700;">üü¢ ${ok} operativos</span>
      <span style="font-family:var(--mono);font-size:12px;background:rgba(239,68,68,.12);border:1px solid rgba(239,68,68,.35);color:var(--red);padding:5px 12px;border-radius:20px;font-weight:700;">üî¥ ${fa} con falla</span>
      <span style="font-family:var(--mono);font-size:12px;background:rgba(0,212,255,.08);border:1px solid rgba(0,212,255,.25);color:var(--cyan);padding:5px 12px;border-radius:20px;font-weight:700;">üì° GW 192.168.150.2</span>
    </div>
  </div>
  <div class="chess-col-labels">
    <div class="chess-left-spacer" style="font-family:var(--mono);font-size:7px;color:var(--text3);display:flex;align-items:flex-end;justify-content:center;padding-bottom:2px;">ROSETA</div>
    ${Array.from({length:10},(_,i)=>{const n=i+1;
      if(n===5||n===6) return '<div style="opacity:.35;color:rgba(0,212,255,.4);">‚îÅ‚îÅ</div>';
      return '<div style="color:var(--text2);font-size:9px;font-weight:700;">C'+n+'</div>';
    }).join('')}
    <div class="chess-right-spacer" style="font-family:var(--mono);font-size:7px;color:var(--text3);display:flex;align-items:flex-end;justify-content:center;padding-bottom:2px;">ROSETA</div>
  </div>
  <div class="chess-scroll" style="margin-top:4px;">
    <div class="chess-room">
      <div class="chess-wall chess-wall-top">
        <span class="chess-wall-txt">üîß CANALETA SUPERIOR ‚Äî CAT-6</span>
        <div style="display:flex;align-items:center;gap:6px;">
          ${patchPins([2,3,4])}
          ${canaleInfo([2,3,4])}
        </div>
        <span style="font-family:var(--mono);font-size:10px;color:var(--purple);font-weight:700;">üëë PP-DOC</span>
      </div>
      <div class="chess-body">
        <div class="chess-left-wall">${leftHTML}</div>
        <div class="chess-board">${boardHTML}</div>
        <div class="chess-right-wall">${rightHTML}</div>
      </div>
      <div class="chess-wall chess-wall-bot" style="justify-content:center;">
        <span class="chess-wall-txt">üîß CANALETA INFERIOR ‚Äî CAT-6</span>
        <div style="display:flex;align-items:center;gap:6px;">
          ${patchPins([13,14,15])}
          ${canaleInfo([13,14,15])}
        </div>
      </div>
    </div>
  </div>
  <div style="display:flex;gap:14px;flex-wrap:wrap;align-items:center;margin-top:12px;padding:11px 16px;background:var(--bg3);border:1px solid var(--border);border-radius:10px;font-size:12px;">
    <div style="display:flex;align-items:center;gap:6px;"><div style="width:11px;height:11px;border-radius:3px;background:rgba(34,197,94,.3);border:1.5px solid #22c55e;"></div><span style="color:var(--text);">üü¢ Operativo</span></div>
    <div style="display:flex;align-items:center;gap:6px;"><div style="width:11px;height:11px;border-radius:3px;background:rgba(239,68,68,.3);border:1.5px solid #ef4444;"></div><span style="color:var(--text);">üî¥ CPU Falla</span></div>
    <div style="display:flex;align-items:center;gap:6px;"><div style="width:6px;height:16px;border-radius:2px;background:var(--cyan);opacity:.85;"></div><span style="color:var(--text);">üîå Puerto Roseta/FP</span></div>
    <span style="font-family:var(--mono);color:#ff6b6b;font-weight:700;">.XX = IP √∫ltimo octeto</span>
    <span style="color:var(--text2);">üëë PC Docente &nbsp;¬∑&nbsp; üñ•Ô∏è Alumno</span>
    <span style="color:var(--text2);">üñ± Hover = datos &nbsp;¬∑&nbsp; Clic = ficha completa</span>
    <span style="font-family:var(--mono);color:rgba(0,212,255,.5);">Cols 5-6 = pasadizo</span>
  </div>
</div>
<div class="cs-panel" id="mapa-sidebar">
  <div class="cs-card">
    <div class="cs-title"><span style="font-size:18px;line-height:1;">üì°</span> RED LAN</div>
    ${[
      {l:'Subred',v:'192.168.149.0/24',c:'var(--cyan)'},
      {l:'M√°scara',v:'255.255.255.0 (/24)',c:'var(--text2)'},
      {l:'Gateway',v:'192.168.150.2',c:'var(--cyan)'},
      {l:'Rango IPs',v:'.41 ‚Üí .72',c:'var(--text2)'},
      {l:'Cableado',v:'UTP CAT-6',c:'var(--green)'},
      {l:'Topolog√≠a',v:'Estrella extendida',c:'var(--blue)'},
      {l:'Total equipos',v:tot,c:'var(--text)'},
      {l:'Operativos',v:ok,c:'var(--green)'},
      {l:'Con falla',v:fa,c:'var(--red)'},
      {l:'MACs',v:withMac+'/'+tot,c:'var(--text2)'},
      {l:'Mouse falla+reg.',v:(mFa+mReg)+'/'+tot,c:'var(--amber)'},
    ].map(r=>'<div class="cs-row"><span style="font-size:12px;color:var(--text2);">'+r.l+'</span><span style="font-family:var(--mono);font-size:12px;font-weight:800;color:'+r.c+';">'+r.v+'</span></div>').join('')}
  </div>
  <div class="cs-card">
    <div class="cs-title"><span style="font-size:18px;line-height:1;">‚ö°</span> SEVERIDAD</div>
    ${Object.entries(SEV_CFG).map(([k,v])=>`
    <div style="display:flex;align-items:center;gap:10px;margin-bottom:8px;">
      <div style="width:10px;height:10px;border-radius:3px;flex-shrink:0;background:${sev_colors[k]||'#888'};box-shadow:0 0 6px ${sev_colors[k]||'#888'};"></div>
      <span style="font-size:12px;color:var(--text);flex:1;font-weight:500;">${v.label}</span>
      <span style="font-family:var(--mono);font-size:14px;font-weight:900;color:${sev_colors[k]||'var(--text)'};">${svC[k]}</span>
      <div style="width:60px;height:7px;background:var(--bg3);border-radius:4px;overflow:hidden;flex-shrink:0;"><div style="height:100%;width:${tot>0?Math.round(svC[k]/tot*100):0}%;background:${sev_colors[k]||'#888'};box-shadow:0 0 6px ${sev_colors[k]||'#888'};border-radius:4px;"></div></div>
    </div>`).join('')}
  </div>
  <div class="cs-card">
    <div class="cs-title"><span style="font-size:18px;line-height:1;">üîå</span> ROSETAS ETHERNET</div>
    <div style="font-family:var(--mono);font-size:8px;color:var(--text3);letter-spacing:1px;margin-bottom:8px;">PC ¬∑ IP √∫ltimo oct. ¬∑ Estado</div>
    ${rosettes.map(row=>`
    <div class="ri-item" style="border-color:${row.color};background:${row.color}08;margin-bottom:7px;padding:5px 7px;border-radius:5px;border-left:3px solid ${row.color};">
      <div style="font-family:var(--mono);font-size:8px;font-weight:700;color:${row.color};margin-bottom:3px;">${row.label}</div>
      ${row.pcs.map(n=>{
        const e=getPC(n);
        const lbl='PC'+String(n).padStart(2,'0');
        const ip=e?'.'+e.ip.split('.').pop():'‚Äî';
        const dot=e?(e.estado==='operativo'?'var(--green)':e.estado==='falla'?'var(--red)':'var(--amber)'):'var(--text3)';
        return '<div style="display:flex;align-items:center;gap:4px;padding:1.5px 0;border-bottom:1px solid rgba(28,45,66,.2);"'
          +(e?' onclick="showDetail(\''+e.id+'\')" onmouseenter="fpShowTip(event,\''+e.id+'\') " onmousemove="fpMoveTip(event)" onmouseleave="fpHideTip()" style="cursor:pointer;display:flex;align-items:center;gap:4px;padding:1.5px 0;border-bottom:1px solid rgba(28,45,66,.2);"':'')+'>'
          +'<div style="width:4px;height:4px;border-radius:50%;background:'+dot+';box-shadow:0 0 4px '+dot+';flex-shrink:0;"></div>'
          +'<span style="font-family:var(--mono);font-size:11px;font-weight:800;flex:1;color:var(--text);">'+lbl+'</span>'
          +'<span style="font-family:var(--mono);font-size:10px;color:#ff6b6b;font-weight:800;">'+ip+'</span>'
          +'</div>';
      }).join('')}
    </div>`).join('')}
  </div>
  <div class="cs-card">
    <div class="cs-title"><span style="font-size:18px;line-height:1;">üåê</span> TABLA IPv4</div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:0 10px;">
      <div>
        <div style="display:flex;justify-content:space-between;font-family:var(--mono);font-size:9px;color:var(--text3);padding-bottom:5px;margin-bottom:4px;border-bottom:1px solid var(--border);letter-spacing:.5px;">
          <span>#</span><span style="flex:1;padding-left:6px;">IP</span><span></span>
        </div>
        ${equipos.slice(0,16).map(e=>{
          const num=e.codigo.split('/').pop()?.trim();
          const dot=e.estado==='operativo'?'var(--green)':'var(--red)';
          return '<div style="display:flex;align-items:center;gap:5px;padding:4px 0;border-bottom:1px solid rgba(28,45,66,.25);">'
            +'<span style="font-family:var(--mono);font-size:9px;color:var(--text3);min-width:22px;">'+num+'</span>'
            +'<span style="flex:1;font-size:11px;color:var(--text2);">'+fmtIP(e.ip)+'</span>'
            +'<span style="width:7px;height:7px;border-radius:50%;background:'+dot+';box-shadow:0 0 5px '+dot+';flex-shrink:0;"></span>'
            +'</div>';
        }).join('')}
      </div>
      <div>
        <div style="display:flex;justify-content:space-between;font-family:var(--mono);font-size:9px;color:var(--text3);padding-bottom:5px;margin-bottom:4px;border-bottom:1px solid var(--border);letter-spacing:.5px;">
          <span>#</span><span style="flex:1;padding-left:6px;">IP</span><span></span>
        </div>
        ${equipos.slice(16).map(e=>{
          const num=e.codigo.split('/').pop()?.trim();
          const dot=e.estado==='operativo'?'var(--green)':'var(--red)';
          return '<div style="display:flex;align-items:center;gap:5px;padding:4px 0;border-bottom:1px solid rgba(28,45,66,.25);">'
            +'<span style="font-family:var(--mono);font-size:9px;color:var(--text3);min-width:22px;">'+num+'</span>'
            +'<span style="flex:1;font-size:11px;color:var(--text2);">'+fmtIP(e.ip)+'</span>'
            +'<span style="width:7px;height:7px;border-radius:50%;background:'+dot+';box-shadow:0 0 5px '+dot+';flex-shrink:0;"></span>'
            +'</div>';
        }).join('')}
      </div>
    </div>
  </div>
</div>
</div>
<div class="fp-tip" id="fp-tip"></div>
  `;
  // Responsive sidebar handled by CSS media queries
}

// ‚ïê‚ïê DETAIL ‚ïê‚ïê
function showDetail(id){
  const e=equipos.find(x=>x.id===id);if(!e)return;
  document.getElementById('d-title').textContent=`FICHA T√âCNICA ‚Äî ${e.codigo}`;
  document.getElementById('d-edit-btn').onclick=()=>{closeDetail();openModal(id);};
  document.getElementById('d-body').innerHTML=buildDetail(e);
  document.getElementById('ov-detail').classList.add('open');
  setTimeout(()=>genQR(e),250);
}
function closeDetail(){document.getElementById('ov-detail').classList.remove('open');}

function dr(l,v){return`<div class="detail-row"><span class="detail-lbl">${l}</span><span class="detail-val">${v||'‚Äî'}</span></div>`;}

function buildDetail(e){
  const s=getSev(e),sc=SEV_CFG[s];
  return`<div class="detail-layout">
    <div class="detail-sections">
      <div class="detail-sec">
        <div class="detail-sec-title">DATOS GENERALES</div>
        <div class="detail-grid2">
          ${dr('C√≥digo',`<span style="color:var(--cyan);font-family:var(--mono);">${e.codigo}</span>`)}
          ${dr('Estado CPU',stBadge(e.estado))}
          ${dr('Ubicaci√≥n',e.ubicacion)}
          ${dr('Usuario',e.usuario)}
          ${dr('Severidad Obs.',sevBadge(e))}
        </div>
      </div>
      <div class="detail-sec">
        <div class="detail-sec-title">PROCESADOR, MEMORIA & GR√ÅFICA</div>
        <div class="detail-grid2">
          ${dr('CPU Marca',e.cpu_marca)}
          ${dr('CPU Modelo',e.cpu_modelo)}
          ${dr('Velocidad',e.cpu_ghz)}
          ${dr('RAM',`${e.ram_cap} ${e.ram_tipo}`)}
          ${dr('Gr√°fica (VRAM)',e.grafica||'‚Äî')}
        </div>
      </div>
      <div class="detail-sec">
        <div class="detail-sec-title">ALMACENAMIENTO & PERIF√âRICOS</div>
        <div class="detail-grid2">
          ${dr('Almacenamiento',e.hdd_tipo&&e.hdd_tipo!=='-'?`${e.hdd_tipo} ${e.hdd_cap}`:'‚Äî')}
          ${dr('Monitor',`${e.monitor_marca} ${e.monitor_tam}${e.monitor_obs?` ¬∑ <span style="color:var(--amber);">‚ö† ${e.monitor_obs}</span>`:''}`)}
          ${dr('Teclado',`${e.teclado_marca||'‚Äî'} ¬∑ ${perBadge(e.teclado_estado)}`)}
          ${dr('Mouse',`${e.mouse_marca||'‚Äî'} ¬∑ ${perBadge(e.mouse_estado)}`)}
        </div>
      </div>
      <div class="detail-sec">
        <div class="detail-sec-title">RED Y CABLEADO (Redes y Telecom.)</div>
        <div class="detail-grid2">
          ${dr('Direcci√≥n IP',fmtIP(e.ip))}
          ${dr('Gateway',`<span style="font-family:var(--mono);">${e.gateway}</span>`)}
          ${dr('MAC Address',`<span style="font-family:var(--mono);font-size:11px;">${e.mac||'‚Äî'}</span>`)}
          ${dr('Protocolo',`<span style="font-family:var(--mono);">TCP/IP v4 ¬∑ DHCP/Est√°tica</span>`)}
          ${dr('Puerto Switch',e.puerto_sw)}
          ${dr('Puerto Patch Panel',e.puerto_pp)}
          ${dr('Rack/Gabinete',e.rack)}
          ${dr('Tipo Cable',`<span style="color:var(--cyan);">${e.cable_tipo}</span>`)}
        </div>
      </div>
      ${e.fallas&&e.fallas!=='-'?`
      <div class="detail-sec">
        <div class="detail-sec-title">OBSERVACIONES & FALLAS</div>
        <div class="${sc.cls}" style="border-radius:8px;padding:10px 14px;margin-bottom:8px;">
          <div style="font-size:11px;font-weight:700;margin-bottom:4px;">${sc.label} ‚Äî ${sc.desc}</div>
          <div style="font-size:12px;opacity:.9;">‚ö† ${e.fallas}</div>
        </div>
        ${e.solucion?`<div class="sev-ok" style="border-radius:8px;padding:10px 14px;font-size:12px;">‚úî Soluci√≥n: ${e.solucion}</div>`:`<div style="font-size:11px;color:var(--text3);font-style:italic;">Soluci√≥n: Pendiente</div>`}
      </div>`:''}
    </div>
    <div class="detail-sidebar">
      <div class="qr-box">
        <div class="qr-label">QR ‚Äî FICHA T√âCNICA</div>
        <div id="qr-canvas"></div>
        <button class="btn btn-ghost btn-sm" style="width:100%;margin-top:8px;font-size:11px;justify-content:center;" onclick="dlQR('${e.codigo}')">‚¨á DESCARGAR QR</button>
      </div>
      <div style="background:var(--bg3);border:1px solid var(--border);border-radius:var(--r2);padding:14px;">
        <div style="font-family:var(--mono);font-size:9px;color:var(--text3);letter-spacing:2px;text-transform:uppercase;margin-bottom:8px;">MANTENIMIENTO</div>
        ${dr('√öltimo Mant.',e.mant_fecha)}
        ${dr('Tipo',e.mant_tipo)}
      </div>
      <button class="btn btn-primary btn-sm" style="width:100%;justify-content:center;" onclick="closeDetail();openModal('${e.id}')">‚úè EDITAR</button>
      <button class="btn btn-danger btn-sm" style="width:100%;justify-content:center;" onclick="closeDetail();delEq('${e.id}')">‚úï ELIMINAR</button>
    </div>
  </div>`;
}

function genQR(e){
  const c=document.getElementById('qr-canvas');if(!c)return;
  c.innerHTML='';
  const txt=`SGILAB P5-206\nCOD: ${e.codigo}\nUBIC: ${e.ubicacion}\nUSU: ${e.usuario}\nESTADO: ${e.estado.toUpperCase()}\nCPU: ${e.cpu_modelo} ${e.cpu_ghz}\nRAM: ${e.ram_cap} ${e.ram_tipo}\nGPU: ${e.grafica}\nIP: ${e.ip}\nGW: ${e.gateway}\nMAC: ${e.mac}\nFALLAS: ${e.fallas||'Ninguna'}`;
  try{new QRCode(c,{text:txt,width:155,height:155,colorDark:'#00d4ff',colorLight:'#0b1120',correctLevel:QRCode.CorrectLevel.M});}
  catch{c.innerHTML=`<div style="font-size:10px;color:var(--text3);text-align:center;padding:20px;">QR no disponible</div>`;}
}
function dlQR(cod){const cv=document.querySelector('#qr-canvas canvas');if(!cv)return;const a=document.createElement('a');a.download=`QR_${cod.replace(/[^a-z0-9]/gi,'_')}.png`;a.href=cv.toDataURL();a.click();}

// ‚ïê‚ïê FORM ‚ïê‚ïê
function openModal(id=null){
  editId=id;clearF();
  if(id){const e=equipos.find(x=>x.id===id);if(!e)return;document.getElementById('f-title').textContent='EDITAR ‚Äî '+e.codigo;fillF(e);}
  else{document.getElementById('f-title').textContent='REGISTRAR NUEVO EQUIPO';}
  document.getElementById('ov-form').classList.add('open');
}
function closeModal(){document.getElementById('ov-form').classList.remove('open');editId=null;}
function clearF(){document.getElementById('eq-form').reset();['fe-cod','fe-ip'].forEach(id=>{const el=document.getElementById(id);if(el)el.textContent='';});}
function fillF(e){
  const s=(id,v)=>{const el=document.getElementById(id);if(el)el.value=v||'';};
  s('fc-cod',e.codigo);s('fc-ub',e.ubicacion);s('fc-usr',e.usuario);s('fc-est',e.estado);
  s('fc-cm',e.cpu_marca);s('fc-cmod',e.cpu_modelo);s('fc-cghz',e.cpu_ghz);
  s('fc-ram',e.ram_cap);s('fc-ramt',e.ram_tipo);s('fc-gpu',e.grafica);
  s('fc-ht',e.hdd_tipo);s('fc-hc',e.hdd_cap);
  s('fc-mm',e.monitor_marca);s('fc-mt',e.monitor_tam);s('fc-mo',e.monitor_obs);
  s('fc-tkm',e.teclado_marca);s('fc-tke',e.teclado_estado);
  s('fc-mum',e.mouse_marca);s('fc-mue',e.mouse_estado);
  s('fc-ip',e.ip);s('fc-gw',e.gateway);s('fc-mac',e.mac);
  s('fc-sw',e.puerto_sw);s('fc-pp',e.puerto_pp);s('fc-rk',e.rack);s('fc-cab',e.cable_tipo);
  s('fc-mf',e.mant_fecha==='-'?'':e.mant_fecha);s('fc-mt2',e.mant_tipo);
  s('fc-fa',e.fallas);s('fc-sol',e.solucion);
}
function getF(){
  const g=id=>(document.getElementById(id)?.value||'').trim();
  return{codigo:g('fc-cod'),ubicacion:g('fc-ub'),usuario:g('fc-usr'),estado:g('fc-est'),
    cpu_marca:g('fc-cm'),cpu_modelo:g('fc-cmod'),cpu_ghz:g('fc-cghz'),
    ram_cap:g('fc-ram'),ram_tipo:g('fc-ramt'),grafica:g('fc-gpu'),
    hdd_tipo:g('fc-ht'),hdd_cap:g('fc-hc'),
    monitor_marca:g('fc-mm'),monitor_tam:g('fc-mt'),monitor_obs:g('fc-mo'),
    teclado_marca:g('fc-tkm'),teclado_estado:g('fc-tke'),
    mouse_marca:g('fc-mum'),mouse_estado:g('fc-mue'),
    ip:g('fc-ip'),gateway:g('fc-gw'),mac:g('fc-mac'),
    puerto_sw:g('fc-sw'),puerto_pp:g('fc-pp'),rack:g('fc-rk'),cable_tipo:g('fc-cab'),
    mant_fecha:g('fc-mf')||'-',mant_tipo:g('fc-mt2'),fallas:g('fc-fa'),solucion:g('fc-sol')};
}
function saveEq(){
  const d=getF();let ok=true;
  const se=(id,m)=>{const el=document.getElementById(id);if(el)el.textContent=m;};
  se('fe-cod','');se('fe-ip','');
  if(!d.codigo){se('fe-cod','Requerido');ok=false;}
  if(!d.ip){se('fe-ip','Requerida');ok=false;}
  else if(!/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/.test(d.ip)){se('fe-ip','Formato inv√°lido');ok=false;}
  const dup=equipos.find(e=>e.codigo===d.codigo&&e.id!==editId);
  if(dup){se('fe-cod','C√≥digo ya existe');ok=false;}
  if(!ok)return;
  if(editId){const i=equipos.findIndex(e=>e.id===editId);equipos[i]={...equipos[i],...d};toast('Equipo actualizado','success');}
  else{equipos.push({id:gid(),...d});toast('Equipo registrado','success');}
  save();closeModal();renderEq();renderDash();
}
function delEq(id){
  const e=equipos.find(x=>x.id===id);
  if(!e||!confirm(`¬øEliminar ${e.codigo}?`))return;
  equipos=equipos.filter(x=>x.id!==id);save();renderEq();renderDash();toast(`${e.codigo} eliminado`,'info');
}

// ‚ïê‚ïê REPORTS ‚ïê‚ïê
function renderReportes(){
  const tot=equipos.length;
  const ok=equipos.filter(e=>e.estado==='operativo').length;
  const fa=equipos.filter(e=>e.estado==='falla').length;
  const mnt=equipos.filter(e=>e.estado==='mantenimiento').length;
  const mFa=equipos.filter(e=>e.mouse_estado==='falla').length;
  const mReg=equipos.filter(e=>e.mouse_estado==='regular').length;
  const mOk=tot-mFa-mReg;
  const monRay=equipos.filter(e=>e.monitor_obs&&e.monitor_obs!=='').length;
  const sevCounts={crit:0,alto:0,medio:0,bajo:0,ok:0};
  equipos.forEach(e=>sevCounts[getSev(e)]++);
  const pct=(n,t)=>t>0?Math.round(n/t*100):0;

  // Severity legend
  document.getElementById('sev-legend').innerHTML=Object.entries(SEV_CFG).map(([k,v])=>`
    <span class="sev-leg ${v.cls}">${v.label}: ${sevCounts[k]} equipo${sevCounts[k]!==1?'s':''}</span>
  `).join('');

  document.getElementById('report-cont').innerHTML=`
    <div class="rcard">
      <div class="rcard-title">üñ•Ô∏è Estado de CPU (Hardware)</div>
      ${[['Operativos',ok,'var(--green)'],['Con Falla',fa,'var(--red)'],['Mantenimiento',mnt,'var(--amber)']].map(([l,n,c])=>`
        <div class="bar-item"><span class="bar-lbl">${l}</span>
        <div class="bar-track"><div class="bar-fill" style="width:${pct(n,tot)}%;background:${c};"></div></div>
        <span class="bar-cnt">${n}</span></div>`).join('')}
      <div style="margin-top:10px;padding:8px;background:var(--bg3);border-radius:6px;font-size:11px;color:var(--text2);">
        ‚úÖ CPU: <strong style="color:var(--green);">${ok}/32 operativos</strong> ¬∑ 1 equipo (PC28) sin video
      </div>
    </div>
    <div class="rcard">
      <div class="rcard-title">üñ±Ô∏è Estado de Mouse (Perif√©ricos)</div>
      ${[['Bueno',mOk,'var(--green)'],['Regular (Scroll)',mReg,'var(--amber)'],['Con Falla (Scroll)',mFa,'var(--red)']].map(([l,n,c])=>`
        <div class="bar-item"><span class="bar-lbl">${l}</span>
        <div class="bar-track"><div class="bar-fill" style="width:${pct(n,tot)}%;background:${c};"></div></div>
        <span class="bar-cnt">${n}</span></div>`).join('')}
      <div style="margin-top:10px;padding:8px;background:var(--bg3);border-radius:6px;font-size:11px;color:var(--amber);">
        ‚ö† ${mFa+mReg} equipos con scroll de mouse defectuoso o regular
      </div>
    </div>
    <div class="rcard">
      <div class="rcard-title">üìä Clasificaci√≥n por Severidad</div>
      ${Object.entries(SEV_CFG).map(([k,v])=>{const n=sevCounts[k];return`
        <div class="bar-item"><span class="bar-lbl" style="font-size:10px;">${v.label}</span>
        <div class="bar-track"><div class="bar-fill" style="width:${pct(n,tot)}%;background:${k==='crit'?'var(--red)':k==='alto'?'var(--orange)':k==='medio'?'var(--amber)':k==='bajo'?'#eab308':'var(--green)'};"></div></div>
        <span class="bar-cnt">${n}</span></div>`;}).join('')}
    </div>
    <div class="rcard">
      <div class="rcard-title">üñ•Ô∏è Monitores</div>
      ${[['Sin obs.',tot-monRay,'var(--green)'],['Con rayas',monRay,'var(--orange)']].map(([l,n,c])=>`
        <div class="bar-item"><span class="bar-lbl">${l}</span>
        <div class="bar-track"><div class="bar-fill" style="width:${pct(n,tot)}%;background:${c};"></div></div>
        <span class="bar-cnt">${n}</span></div>`).join('')}
    </div>
    <div class="rcard">
      <div class="rcard-title">üì° Red y Telecomunicaciones</div>
      <div style="font-size:12px;color:var(--text2);line-height:2;">
        <div>Subred: <strong style="color:var(--cyan);font-family:var(--mono);">192.168.149.0/24</strong></div>
        <div>Rango IPs: <strong style="color:var(--text);font-family:var(--mono);">.41 ‚Äî .72</strong></div>
        <div>Gateway: <strong style="color:var(--cyan);font-family:var(--mono);">192.168.150.2</strong></div>
        <div>Cableado: <strong style="color:var(--text);">UTP CAT-6</strong></div>
        <div>Con MAC registrada: <strong style="color:var(--green);">${equipos.filter(e=>e.mac&&e.mac.trim()).length}/32</strong></div>
        <div>Sin MAC: <strong style="color:var(--red);">${equipos.filter(e=>!e.mac||!e.mac.trim()).length}/32</strong></div>
      </div>
    </div>
    <div class="rcard">
      <div class="rcard-title">‚ö° Resumen Ejecutivo</div>
      <div style="font-size:12px;color:var(--text2);line-height:1.9;">
        <div>Total equipos: <strong style="color:var(--text);">32</strong></div>
        <div>CPU 100% operativos: <strong style="color:var(--green);">31/32 (97%)</strong></div>
        <div>CPU con falla cr√≠tica: <strong style="color:var(--red);">1/32 (PC28)</strong></div>
        <div>Perif√©ricos con falla: <strong style="color:var(--amber);">${mFa+mReg}/32</strong></div>
        <div>Monitores con rayas: <strong style="color:var(--orange);">${monRay}/32</strong></div>
        <div>Equipos sin observaciones: <strong style="color:var(--green);">${sevCounts.ok}/32</strong></div>
      </div>
    </div>
  `;

  // Fallas table with severity
  const conF=equipos.filter(e=>e.fallas&&e.fallas.trim()&&e.fallas!=='-');
  conF.sort((a,b)=>{const o=['crit','alto','medio','bajo','ok'];return o.indexOf(getSev(a))-o.indexOf(getSev(b));});
  document.getElementById('fallas-wrap').innerHTML=`
    <div style="font-family:var(--head);font-size:15px;font-weight:700;letter-spacing:1px;margin-bottom:14px;color:var(--text);">
      LISTADO COMPLETO DE FALLAS Y OBSERVACIONES
      <span style="font-size:11px;font-weight:400;color:var(--text3);margin-left:8px;">${conF.length} equipos con observaciones</span>
    </div>
    <div class="tbl-wrap"><table><thead><tr>
      <th>C√≥digo</th><th>Ubicaci√≥n</th><th>Estado CPU</th><th>Severidad</th><th>IP</th><th>Patch Panel</th><th>Fallas detectadas</th><th>Mouse</th><th>Monitor</th><th>Soluci√≥n</th>
    </tr></thead><tbody>
      ${conF.map(e=>`<tr>
        <td><span class="td-mono" style="color:var(--cyan);font-size:10px;">${e.codigo}</span></td>
        <td class="td-bold">${e.ubicacion}</td>
        <td>${stBadge(e.estado)}</td>
        <td>${sevBadge(e)}</td>
        <td>${fmtIP(e.ip)}</td>
        <td class="td-mono" style="font-size:11px;color:rgba(255,200,100,.9);font-weight:700;">${e.puerto_pp&&e.puerto_pp!=='-'?e.puerto_pp:'‚Äî'}</td>
        <td style="max-width:240px;white-space:normal;font-size:11px;">${e.fallas}</td>
        <td>${perBadge(e.mouse_estado)}</td>
        <td style="font-size:11px;">${e.monitor_obs||'‚Äî'}</td>
        <td style="font-size:11px;">${e.solucion||'<span style="color:var(--text3);">Pendiente</span>'}</td>
      </tr>`).join('')}
    </tbody></table></div>`;
}

// ‚ïê‚ïê EXPORTS ‚ïê‚ïê
function exportCSV(){
  const cols=['codigo','ubicacion','usuario','estado','cpu_modelo','cpu_ghz','ram_cap','ram_tipo','grafica','hdd_tipo','hdd_cap','monitor_marca','monitor_tam','monitor_obs','teclado_marca','teclado_estado','mouse_marca','mouse_estado','ip','gateway','mac','puerto_sw','puerto_pp','rack','cable_tipo','mant_fecha','mant_tipo','fallas','solucion'];
  const hdr=cols.join(',');
  const rows=equipos.map(e=>cols.map(c=>`"${(e[c]||'').toString().replace(/"/g,'""')}"`).join(','));
  const csv=[hdr,...rows].join('\n');
  dl('data:text/csv;charset=utf-8,'+encodeURIComponent(csv),'inventario_lab_p5_206.csv');
  toast('CSV exportado correctamente','success');
}
function exportJSON(){
  dl('data:application/json;charset=utf-8,'+encodeURIComponent(JSON.stringify(equipos,null,2)),'inventario_lab_p5_206.json');
  toast('JSON exportado correctamente','success');
}
function exportPDF(){
  // Open print dialog with a printable version
  const w=window.open('','_blank');
  const now=new Date().toLocaleDateString('es-PE');
  const ok=equipos.filter(e=>e.estado==='operativo').length;
  const fa=equipos.filter(e=>e.estado==='falla').length;
  const mFa=equipos.filter(e=>e.mouse_estado==='falla').length;
  const mReg=equipos.filter(e=>e.mouse_estado==='regular').length;
  const sevC={crit:0,alto:0,medio:0,bajo:0,ok:0};equipos.forEach(e=>sevC[getSev(e)]++);
  const rows=equipos.map((e,i)=>{const s=getSev(e);const colors={crit:'#fecaca',alto:'#fed7aa',medio:'#fef08a',bajo:'#fef9c3',ok:'#dcfce7'};return`
    <tr style="background:${colors[s]||'#fff'}">
      <td>${i+1}</td><td style="font-weight:600;">${e.codigo}</td>
      <td>${e.ubicacion}</td><td>${e.usuario}</td>
      <td style="color:${e.estado==='operativo'?'#166534':'#991b1b'};font-weight:600;">${e.estado.toUpperCase()}</td>
      <td>${e.cpu_modelo}</td><td>${e.ram_cap} ${e.ram_tipo}</td>
      <td>${e.grafica||'‚Äî'}</td>
      <td style="font-family:monospace;">${e.ip}</td>
      <td style="font-family:monospace;font-size:10px;">${e.mac||'‚Äî'}</td>
      <td style="color:${e.mouse_estado==='falla'?'#991b1b':e.mouse_estado==='regular'?'#92400e':'#166534'}">${e.mouse_estado.toUpperCase()}</td>
      <td style="font-size:10px;max-width:180px;">${e.fallas||'‚Äî'}</td>
      <td>${SEV_CFG[s]?.label||'‚Äî'}</td>
    </tr>`}).join('');
  w.document.write(`<!DOCTYPE html><html><head><meta charset="UTF-8"><title>Inventario LAB P5-206</title>
    <style>
      body{font-family:Arial,sans-serif;font-size:11px;color:#111;margin:20px;}
      h1{font-size:18px;margin-bottom:4px;} h2{font-size:14px;color:#1e40af;margin:16px 0 8px;}
      .hd{border-bottom:3px solid #1e40af;padding-bottom:10px;margin-bottom:16px;}
      .sub{font-size:11px;color:#555;}
      .stats{display:flex;gap:16px;margin-bottom:16px;flex-wrap:wrap;}
      .s{background:#f0f9ff;border:1px solid #bae6fd;padding:8px 14px;border-radius:6px;text-align:center;}
      .s-v{font-size:22px;font-weight:800;color:#1e40af;} .s-l{font-size:10px;color:#555;}
      table{width:100%;border-collapse:collapse;font-size:10px;}
      th{background:#1e40af;color:#fff;padding:7px 6px;text-align:left;white-space:nowrap;}
      td{padding:5px 6px;border-bottom:1px solid #e5e7eb;}
      .leg{display:flex;gap:12px;margin:10px 0;flex-wrap:wrap;font-size:10px;}
      .leg span{display:flex;align-items:center;gap:4px;}
      .dot{width:10px;height:10px;border-radius:3px;display:inline-block;}
      @page{margin:1.5cm;size:A4 landscape;}
      @media print{button{display:none;}}
    </style></head><body>
    <div class="hd">
      <h1>üìã SGILAB ‚Äî Inventario de Equipos ¬∑ Laboratorio P5-206</h1>
      <div class="sub">Redes y Telecomunicaciones ¬∑ Ingenier√≠a de Sistemas ¬∑ Generado: ${now}</div>
      <div class="sub">Autores: Acosta Falcon M.A. ¬∑ Aliaga Salas H.M. ¬∑ Colqui Guillermo V.D. ¬∑ Espinoza Berrospi D.O.</div>
    </div>
    <div class="stats">
      <div class="s"><div class="s-v">${equipos.length}</div><div class="s-l">TOTAL</div></div>
      <div class="s"><div class="s-v" style="color:#166534;">${ok}</div><div class="s-l">CPU OPER.</div></div>
      <div class="s"><div class="s-v" style="color:#991b1b;">${fa}</div><div class="s-l">CPU FALLA</div></div>
      <div class="s"><div class="s-v" style="color:#92400e;">${mFa}</div><div class="s-l">MOUSE FALLA</div></div>
      <div class="s"><div class="s-v" style="color:#854d0e;">${mReg}</div><div class="s-l">MOUSE REGULAR</div></div>
      <div class="s"><div class="s-v" style="color:#991b1b;">${sevC.crit}</div><div class="s-l">CR√çTICO</div></div>
    </div>
    <div class="leg">
      <span><span class="dot" style="background:#fecaca;border:1px solid #f87171;"></span>üî¥ Cr√≠tico</span>
      <span><span class="dot" style="background:#fed7aa;border:1px solid #fb923c;"></span>üü† Alto</span>
      <span><span class="dot" style="background:#fef08a;border:1px solid #facc15;"></span>üü° Medio</span>
      <span><span class="dot" style="background:#fef9c3;border:1px solid #eab308;"></span>üü§ Bajo</span>
      <span><span class="dot" style="background:#dcfce7;border:1px solid #4ade80;"></span>üü¢ Sin falla</span>
    </div>
    <table><thead><tr>
      <th>#</th><th>C√≥digo</th><th>Ubicaci√≥n</th><th>Usuario</th><th>Estado CPU</th>
      <th>CPU Modelo</th><th>RAM / Tipo</th><th>GPU</th><th>IP</th><th>MAC</th>
      <th>Mouse</th><th>Fallas / Observaciones</th><th>Severidad</th>
    </tr></thead><tbody>${rows}</tbody></table>
    <div style="margin-top:16px;text-align:center;font-size:10px;color:#888;">
      Laboratorio P5-206 ¬∑ Redes y Telecomunicaciones ¬∑ ${now} ¬∑ P√°g. <span id="pn"></span>
    </div>
    <script>window.onload=function(){window.print();}<\/script>
  </body></html>`);
  w.document.close();
  toast('Generando PDF para impresi√≥n...','info');
}
function printReport(){window.print();toast('Abriendo di√°logo de impresi√≥n...','info');}
function dl(href,name){const a=document.createElement('a');a.href=href;a.download=name;a.click();}

// ‚îÄ‚îÄ OVERLAYS ‚îÄ‚îÄ
document.getElementById('ov-detail').addEventListener('click',function(e){if(e.target===this)closeDetail();});
document.getElementById('ov-form').addEventListener('click',function(e){if(e.target===this)closeModal();});

// ‚îÄ‚îÄ INIT ‚îÄ‚îÄ
load();
showView('dashboard');
</script>
</body>
</html>
